<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>smelli.classes API documentation</title>
    <meta name="description" content="" />

  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Noto+Sans:400' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/public/plugins/katex/katex.min.css">
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

    .katex {
      font-size:1em;
    }
    .katex .mathit, .katex .mathrm {
      font-family: 'Noto Sans';
    }
  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  }

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; }

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;

      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  pre { line-height: 125%; margin: 0; }
td.linenos pre { color: #000000; background-color: #f0f0f0; padding: 0 5px 0 5px; }
span.linenos { color: #000000; background-color: #f0f0f0; padding: 0 5px 0 5px; }
td.linenos pre.special { color: #000000; background-color: #ffffc0; padding: 0 5px 0 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding: 0 5px 0 5px; }
.codehilite .hll { background-color: #ffffcc }
.codehilite { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
    <script src="/public/plugins/katex/katex.min.js"></script>
    <script src="/public/plugins/katex/auto-render.min.js"></script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">


    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#smelli.classes.CustomLikelihood">CustomLikelihood</a></span>
        
          
  <ul>
    <li class="mono"><a href="#smelli.classes.CustomLikelihood.__init__">__init__</a></li>
    <li class="mono"><a href="#smelli.classes.CustomLikelihood.get_number_observations">get_number_observations</a></li>
    <li class="mono"><a href="#smelli.classes.CustomLikelihood.log_likelihood">log_likelihood</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#smelli.classes.GlobalLikelihood">GlobalLikelihood</a></span>
        
          
  <ul>
    <li class="mono"><a href="#smelli.classes.GlobalLikelihood.__init__">__init__</a></li>
    <li class="mono"><a href="#smelli.classes.GlobalLikelihood.get_ckm_sm">get_ckm_sm</a></li>
    <li class="mono"><a href="#smelli.classes.GlobalLikelihood.get_wilson">get_wilson</a></li>
    <li class="mono"><a href="#smelli.classes.GlobalLikelihood.load_exp_covariances">load_exp_covariances</a></li>
    <li class="mono"><a href="#smelli.classes.GlobalLikelihood.load_sm_covariances">load_sm_covariances</a></li>
    <li class="mono"><a href="#smelli.classes.GlobalLikelihood.make_measurement">make_measurement</a></li>
    <li class="mono"><a href="#smelli.classes.GlobalLikelihood.number_observations_dict">number_observations_dict</a></li>
    <li class="mono"><a href="#smelli.classes.GlobalLikelihood.plot_data_2d">plot_data_2d</a></li>
    <li class="mono"><a href="#smelli.classes.GlobalLikelihood.save_exp_covariances">save_exp_covariances</a></li>
    <li class="mono"><a href="#smelli.classes.GlobalLikelihood.save_sm_covariances">save_sm_covariances</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#smelli.classes.GlobalLikelihoodPoint">GlobalLikelihoodPoint</a></span>
        
          
  <ul>
    <li class="mono"><a href="#smelli.classes.GlobalLikelihoodPoint.__init__">__init__</a></li>
    <li class="mono"><a href="#smelli.classes.GlobalLikelihoodPoint.chi2_dict">chi2_dict</a></li>
    <li class="mono"><a href="#smelli.classes.GlobalLikelihoodPoint.get_ckm_np">get_ckm_np</a></li>
    <li class="mono"><a href="#smelli.classes.GlobalLikelihoodPoint.log_likelihood_dict">log_likelihood_dict</a></li>
    <li class="mono"><a href="#smelli.classes.GlobalLikelihoodPoint.log_likelihood_global">log_likelihood_global</a></li>
    <li class="mono"><a href="#smelli.classes.GlobalLikelihoodPoint.obstable">obstable</a></li>
    <li class="mono"><a href="#smelli.classes.GlobalLikelihoodPoint.pvalue_dict">pvalue_dict</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">smelli.classes</span> module</h1>
  
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes" class="source">
    <div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">flavio</span>
<span class="kn">from</span> <span class="nn">wilson</span> <span class="kn">import</span> <span class="n">Wilson</span><span class="p">,</span> <span class="n">wcxf</span>
<span class="kn">from</span> <span class="nn">flavio.statistics.likelihood</span> <span class="kn">import</span> <span class="n">Likelihood</span><span class="p">,</span> <span class="n">FastLikelihood</span>
<span class="kn">from</span> <span class="nn">flavio.statistics.probability</span> <span class="kn">import</span> <span class="n">NormalDistribution</span>
<span class="kn">from</span> <span class="nn">flavio.statistics.functions</span> <span class="kn">import</span> <span class="n">pull</span><span class="p">,</span> <span class="n">pvalue</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">ceil</span>
<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">tree</span><span class="p">,</span> <span class="n">get_datapath</span>
<span class="kn">from</span> <span class="nn">.ckm</span> <span class="kn">import</span> <span class="n">get_ckm_schemes</span>
<span class="kn">from</span> <span class="nn">multipledispatch</span> <span class="kn">import</span> <span class="n">dispatch</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
<span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Number</span>


<span class="c1"># by default, smelli uses leading log accuracy for SMEFT running!</span>
<span class="n">Wilson</span><span class="o">.</span><span class="n">set_default_option</span><span class="p">(</span><span class="s1">&#39;smeft_accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;leadinglog&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GlobalLikelihood</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class that provides a global likelihood in SMEFT Wilson</span>
<span class="sd">    coefficient space.</span>

<span class="sd">    User methods:</span>

<span class="sd">    - `log_likelihood`: return an instance of LieklihoodResult</span>
<span class="sd">    given a dictionary of Wilson coefficients at a given scale</span>
<span class="sd">    - `log_likelihood_wcxf`: return an instance of LieklihoodResult</span>
<span class="sd">    given the path to a WCxf file</span>
<span class="sd">    - `log_likelihood_wilson`: return an instance of LieklihoodResult+</span>
<span class="sd">    given an instance of `wilson.Wilson`</span>

<span class="sd">    Utility methods:</span>

<span class="sd">    - `make_measurement`: compute the SM covariances. Note that it is only</span>
<span class="sd">    necessary to call this method when changes to the default</span>
<span class="sd">    parameters/uncertainties have been made</span>
<span class="sd">    - `save_sm_covariances`, `load_sm_covariances`: Save the calculated SM</span>
<span class="sd">    covariances or load them from data files</span>
<span class="sd">    - `save_exp_covariances`, `load_exp_covariances`: Save the calculated</span>
<span class="sd">    experimental central values and covariances or load them from data files</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_default_bases</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;SMEFT&#39;</span><span class="p">:</span> <span class="s1">&#39;Warsaw&#39;</span><span class="p">,</span> <span class="s1">&#39;WET&#39;</span><span class="p">:</span> <span class="s1">&#39;flavio&#39;</span><span class="p">}</span>

    <span class="n">_fast_likelihoods_yaml_fixckm</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;fast_likelihood_quarks_fixckm.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fast_likelihood_leptons.yaml&#39;</span>
    <span class="p">]</span>

    <span class="n">_fast_likelihoods_yaml</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;fast_likelihood_quarks.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fast_likelihood_leptons.yaml&#39;</span>
    <span class="p">]</span>

    <span class="n">_likelihoods_yaml</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;likelihood_ewpt.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood_eeww.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood_lept.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood_rd_rds.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood_lfu_fccc.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood_lfu_fcnc.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood_bcpv.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood_bqnunu.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood_lfv.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood_zlfv.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood_higgs.yaml&#39;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eft</span><span class="o">=</span><span class="s1">&#39;SMEFT&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">par_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">include_likelihoods</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">exclude_likelihoods</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">Nexp</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
                 <span class="n">exp_cov_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">sm_cov_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">custom_likelihoods</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">fix_ckm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">ckm_scheme</span><span class="o">=</span><span class="s1">&#39;CKMSchemeRmuBtaunuBxlnuDeltaM&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the likelihood.</span>

<span class="sd">        Optionally, a dictionary of parameters can be passed as `par_dict`.</span>
<span class="sd">        If not given (or not complete), flavio default parameter values will</span>
<span class="sd">        be used. Note that the CKM elements in `par_dict` will be ignored as</span>
<span class="sd">        the &quot;true&quot; CKM elements will be extracted for each parameter point</span>
<span class="sd">        from the measurement of four input observables:</span>
<span class="sd">        - `&#39;RKpi(P+-&gt;munu)&#39;`</span>
<span class="sd">        - `&#39;BR(B+-&gt;taunu)&#39;`</span>
<span class="sd">        - `&#39;BR(B-&gt;Xcenu)&#39;`</span>
<span class="sd">        - `&#39;DeltaM_d/DeltaM_s&#39;`</span>

<span class="sd">        Parameters:</span>

<span class="sd">        - eft: a WCxf EFT, must be one of &#39;SMEFT&#39; (default) or &#39;WET&#39;.</span>
<span class="sd">        - basis: a WCxf basis, defaults to &#39;Warsaw&#39; for SMEFT and &#39;flavio&#39;</span>
<span class="sd">          for WET.</span>
<span class="sd">        - include_likelihoods: a list of strings specifying the likelihoods</span>
<span class="sd">          to be included (default: all of them). Note that this cannot be used</span>
<span class="sd">          to add likelihoods.</span>
<span class="sd">        - exclude_likelihoods: a list of strings specifying the likelihoods</span>
<span class="sd">          to be excluded (default: none of them).</span>
<span class="sd">        - Nexp: number of random evaluations of the experimental likelihood</span>
<span class="sd">          used to extract the covariance matrix for &quot;fast likelihood&quot;</span>
<span class="sd">          instances. Defaults to 5000.</span>
<span class="sd">        - exp_cov_folder: directory containing saved expererimental</span>
<span class="sd">          covariances. The data files have to be in the format exported by</span>
<span class="sd">          `save_exp_covariances`.</span>
<span class="sd">        - sm_cov_folder: directory containing saved SM</span>
<span class="sd">          covariances. The data files have to be in the format exported by</span>
<span class="sd">          `save_sm_covariances`.</span>
<span class="sd">        - custom_likelihoods: a dictionary in which each value is a list of</span>
<span class="sd">          observables and each key is a string that serves as user-defined</span>
<span class="sd">          name. For each item of the dictionary, a custom likelihood will be</span>
<span class="sd">          computed.</span>
<span class="sd">        - fix_ckm: If False (default), automatically determine the CKM elements</span>
<span class="sd">          in the presence of new physics in processes used to determine these</span>
<span class="sd">          elements in the SM. If set to True, the CKM elements are fixed to</span>
<span class="sd">          their SM values, which can lead to inconsistent results, but also</span>
<span class="sd">          to a significant speedup in specific cases.</span>
<span class="sd">        - ckm_scheme: A string with the name of the class defining the CKM</span>
<span class="sd">          scheme.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eft</span> <span class="o">=</span> <span class="n">eft</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">basis</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_bases</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eft</span><span class="p">]</span>
        <span class="n">par_dict</span> <span class="o">=</span> <span class="n">par_dict</span> <span class="ow">or</span> <span class="p">{}</span>  <span class="c1"># initialize empty if not given</span>
        <span class="c1"># take missing parameters from flavio defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_dict_default</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">default_parameters</span><span class="o">.</span><span class="n">get_central_all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_dict_default</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">par_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_par_dict_sm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span> <span class="o">=</span> <span class="n">fix_ckm</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fast_likelihoods_yaml</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fast_likelihoods_yaml_fixckm</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ckm_scheme</span> <span class="o">=</span> <span class="n">get_ckm_schemes</span><span class="p">()[</span><span class="n">ckm_scheme</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ckm_scheme_name</span> <span class="o">=</span> <span class="n">ckm_scheme</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CKM scheme &#39;</span><span class="si">{}</span><span class="s2">&#39; is not defined.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ckm_scheme</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">likelihoods</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_custom_likelihoods_dict</span> <span class="o">=</span> <span class="n">custom_likelihoods</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_likelihoods</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_likelihoods</span><span class="p">(</span><span class="n">include_likelihoods</span><span class="o">=</span><span class="n">include_likelihoods</span><span class="p">,</span>
                               <span class="n">exclude_likelihoods</span><span class="o">=</span><span class="n">exclude_likelihoods</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Nexp</span> <span class="o">=</span> <span class="n">Nexp</span>
        <span class="k">if</span> <span class="n">exp_cov_folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_exp_covariances</span><span class="p">(</span><span class="n">exp_cov_folder</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sm_cov_loaded</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sm_cov_folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_sm_covariances</span><span class="p">(</span><span class="n">get_datapath</span><span class="p">(</span><span class="s1">&#39;smelli&#39;</span><span class="p">,</span> <span class="s1">&#39;data/cache&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_sm_covariances</span><span class="p">(</span><span class="n">sm_cov_folder</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sm_cov_loaded</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">make_measurement</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;There was a problem loading the SM covariances. &quot;</span>
                          <span class="s2">&quot;Please recompute them with `make_measurement`.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_sm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_sm</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_load_likelihoods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">include_likelihoods</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">exclude_likelihoods</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">include_likelihoods</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">exclude_likelihoods</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;include_likelihoods and exclude_likelihoods &quot;</span>
                             <span class="s2">&quot;should not be specified simultaneously.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">argument_name</span><span class="p">,</span> <span class="n">argument</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;exclude_likelihoods&#39;</span><span class="p">,</span> <span class="n">exclude_likelihoods</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;include_likelihoods&#39;</span><span class="p">,</span><span class="n">include_likelihoods</span><span class="p">)]:</span>
            <span class="k">if</span> <span class="n">argument</span><span class="p">:</span>
                <span class="n">unknown_likelihoods</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fast_likelihoods_yaml</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_likelihoods_yaml</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">unknown_likelihoods</span><span class="p">:</span>  
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> contains unknown likelihoods: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">argument_name</span><span class="p">,</span><span class="n">unknown_likelihoods</span><span class="p">))</span>
        <span class="c1"># load ckm parameters for given CKM scheme</span>
        <span class="n">par_ckm_file</span> <span class="o">=</span> <span class="s1">&#39;par_ckm_</span><span class="si">{}</span><span class="s1">.yaml&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ckm_scheme_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_yaml_path</span><span class="p">(</span><span class="n">par_ckm_file</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">par_ckm_dict</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">load_include</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fast_likelihoods_yaml</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">include_likelihoods</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fn</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">include_likelihoods</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">exclude_likelihoods</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">exclude_likelihoods</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_yaml_path</span><span class="p">(</span><span class="n">fn</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">yaml_dict</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">load_include</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">:</span>
                    <span class="n">yaml_dict</span><span class="p">[</span><span class="s1">&#39;par_obj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">par_ckm_dict</span>
                <span class="n">L</span> <span class="o">=</span> <span class="n">FastLikelihood</span><span class="o">.</span><span class="n">load_dict</span><span class="p">(</span><span class="n">yaml_dict</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_likelihoods_yaml</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">include_likelihoods</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fn</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">include_likelihoods</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">exclude_likelihoods</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">exclude_likelihoods</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eft</span> <span class="o">!=</span> <span class="s1">&#39;SMEFT&#39;</span> <span class="ow">and</span> <span class="n">fn</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;likelihood_ewpt.yaml&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;likelihood_eeww.yaml&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;likelihood_zlfv.yaml&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;likelihood_higgs.yaml&#39;</span><span class="p">,]:</span>
                <span class="k">continue</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_yaml_path</span><span class="p">(</span><span class="n">fn</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">L</span> <span class="o">=</span> <span class="n">Likelihood</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">likelihoods</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">observables</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_custom_likelihoods_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">CustomLikelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observables</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">custom_likelihoods</span><span class="p">[</span><span class="s1">&#39;custom_&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span>

    <span class="k">def</span> <span class="nf">_get_yaml_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a path for the YAML file specified by `name`.</span>
<span class="sd">        If a YAML file with that name is found in the package&#39;s data</span>
<span class="sd">        directory, that is used. Otherwise, `name` is assumed to be a path.</span>

<span class="sd">        Raises `FileNotFoundError` if path does not exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">get_datapath</span><span class="p">(</span><span class="s1">&#39;smelli&#39;</span><span class="p">,</span> <span class="s1">&#39;data/yaml/&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">path</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">get_datapath</span><span class="p">(</span><span class="s1">&#39;smelli&#39;</span><span class="p">,</span> <span class="s1">&#39;data/yaml/&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.yaml&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">path</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.yaml&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.yaml&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Likelihood YAML file &#39;</span><span class="si">{}</span><span class="s2">&#39; was not found&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">make_measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the likelihood by producing a pseudo-measurement containing both</span>
<span class="sd">        experimental uncertainties as well as theory uncertainties stemming</span>
<span class="sd">        from nuisance parameters.</span>

<span class="sd">        Optional parameters:</span>

<span class="sd">        - `N`: number of random computations for the SM covariance (computing</span>
<span class="sd">          time is proportional to it; more means less random fluctuations.)</span>
<span class="sd">        - `Nexp`: number of random computations for the experimental covariance.</span>
<span class="sd">          This is much less expensive than the theory covariance, so a large</span>
<span class="sd">          number can be afforded (default: 5000).</span>
<span class="sd">        - `threads`: number of parallel threads for the SM</span>
<span class="sd">          covariance computation. Defaults to 1 (no parallelization).</span>
<span class="sd">        - `force`: if True, will recompute SM covariance even if it</span>
<span class="sd">          already has been computed. Defaults to False.</span>
<span class="sd">        - `force_exp`: if True, will recompute experimental central values and</span>
<span class="sd">          covariance even if they have already been computed. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;Nexp&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Nexp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Nexp</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">flh</span><span class="o">.</span><span class="n">make_measurement</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sm_cov_loaded</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">save_sm_covariances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_fix_ckm&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ckm_scheme_name</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.p&#39;</span><span class="p">)</span>
            <span class="n">flh</span><span class="o">.</span><span class="n">sm_covariance</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_sm_covariances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_fix_ckm&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ckm_scheme_name</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.p&#39;</span><span class="p">)</span>
            <span class="n">flh</span><span class="o">.</span><span class="n">sm_covariance</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_exp_covariances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.p&#39;</span><span class="p">)</span>
            <span class="n">flh</span><span class="o">.</span><span class="n">exp_covariance</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_exp_covariances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.p&#39;</span><span class="p">)</span>
            <span class="n">flh</span><span class="o">.</span><span class="n">exp_covariance</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">log_likelihood_sm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_sm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_sm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_dict_sm</span><span class="p">,</span> <span class="n">flavio</span><span class="o">.</span><span class="n">WilsonCoefficients</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_sm</span>

    <span class="k">def</span> <span class="nf">_check_sm_cov_loaded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if the SM covariances have been computed or loaded.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sm_cov_loaded</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please load or compute the SM covariances first&quot;</span>
                             <span class="s2">&quot; by calling `make_measurement`.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_ckm_sm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Vus</span><span class="p">,</span> <span class="n">Vcb</span><span class="p">,</span> <span class="n">Vub</span><span class="p">,</span> <span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ckm_scheme</span><span class="o">.</span><span class="n">ckm_np</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Vus&#39;</span><span class="p">:</span> <span class="n">Vus</span><span class="p">,</span> <span class="s1">&#39;Vcb&#39;</span><span class="p">:</span> <span class="n">Vcb</span><span class="p">,</span> <span class="s1">&#39;Vub&#39;</span><span class="p">:</span> <span class="n">Vub</span><span class="p">,</span> <span class="s1">&#39;delta&#39;</span><span class="p">:</span> <span class="n">delta</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">par_dict_sm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the dictionary of parameters where the four CKM parameters</span>
<span class="sd">        `Vus`, `Vcb`, `Vub`, `delta` have been replaced by their</span>
<span class="sd">        &quot;true&quot; values extracted assuming the SM.</span>
<span class="sd">        They should be almost (but not exactly) equal to the default</span>
<span class="sd">        flavio CKM parameters.</span>

<span class="sd">        Note that if `fix_ckm` is set to `True`, this method actually</span>
<span class="sd">        returns the default parameter values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_dict_default</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_par_dict_sm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">par_dict_sm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_dict_default</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">par_dict_sm</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_ckm_sm</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_par_dict_sm</span> <span class="o">=</span> <span class="n">par_dict_sm</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_par_dict_sm</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">obstable_sm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sm_cov_loaded</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_sm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">tree</span><span class="p">()</span>  <span class="c1"># nested dict</span>
            <span class="k">for</span> <span class="n">flh_name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># loop over fast likelihoods: they only have a single &quot;measurement&quot;</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">flh</span><span class="o">.</span><span class="n">pseudo_measurement</span>
                <span class="n">ml</span> <span class="o">=</span> <span class="n">flh</span><span class="o">.</span><span class="n">full_measurement_likelihood</span>
                <span class="n">pred_sm</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">get_predictions_par</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_dict_sm</span><span class="p">,</span>
                                                 <span class="n">flavio</span><span class="o">.</span><span class="n">WilsonCoefficients</span><span class="p">())</span>
                <span class="n">sm_cov</span> <span class="o">=</span> <span class="n">flh</span><span class="o">.</span><span class="n">sm_covariance</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">exp_cov</span> <span class="o">=</span> <span class="n">flh</span><span class="o">.</span><span class="n">exp_covariance</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">inspire_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_inspire_dict</span><span class="p">(</span><span class="n">flh</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span> <span class="n">ml</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">flh</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;lh_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flh_name</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">obs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;th. unc.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sm_cov</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;experiment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_central</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;exp. unc.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">exp_cov</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;exp. PDF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NormalDistribution</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">get_central</span><span class="p">(</span><span class="n">obs</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">exp_cov</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;inspire&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">inspire_dict</span><span class="p">[</span><span class="n">obs</span><span class="p">]))</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;ll_sm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_logprobability_single</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">pred_sm</span><span class="p">[</span><span class="n">obs</span><span class="p">])</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;ll_central&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_logprobability_single</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">get_central</span><span class="p">(</span><span class="n">obs</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">lh_name</span><span class="p">,</span> <span class="n">lh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># loop over &quot;normal&quot; likelihoods</span>
                <span class="n">ml</span> <span class="o">=</span> <span class="n">lh</span><span class="o">.</span><span class="n">measurement_likelihood</span>
                <span class="n">pred_sm</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">get_predictions_par</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_dict_sm</span><span class="p">,</span>
                                                 <span class="n">flavio</span><span class="o">.</span><span class="n">WilsonCoefficients</span><span class="p">())</span>
                <span class="n">inspire_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_inspire_dict</span><span class="p">(</span><span class="n">lh</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span> <span class="n">ml</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lh</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
                    <span class="n">obs_dict</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Observable</span><span class="o">.</span><span class="n">argument_format</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">)</span>
                    <span class="n">obs_name</span> <span class="o">=</span> <span class="n">obs_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
                    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
                        <span class="n">p_comb</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">combine_measurements</span><span class="p">(</span>
                            <span class="n">obs_name</span><span class="p">,</span>
                            <span class="n">include_measurements</span><span class="o">=</span><span class="n">ml</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">obs_dict</span><span class="p">)</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;experiment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_comb</span><span class="o">.</span><span class="n">central_value</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;exp. unc.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">p_comb</span><span class="o">.</span><span class="n">error_left</span><span class="p">,</span> <span class="n">p_comb</span><span class="o">.</span><span class="n">error_right</span><span class="p">)</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;exp. PDF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_comb</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;inspire&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">inspire_dict</span><span class="p">[</span><span class="n">obs</span><span class="p">]))</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;th. unc.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;lh_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lh_name</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">obs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;ll_sm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_comb</span><span class="o">.</span><span class="n">logpdf</span><span class="p">([</span><span class="n">pred_sm</span><span class="p">[</span><span class="n">obs</span><span class="p">]])</span>
                    <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;ll_sm&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
                        <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;ll_sm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1e100</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;ll_central&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_comb</span><span class="o">.</span><span class="n">logpdf</span><span class="p">([</span><span class="n">p_comb</span><span class="o">.</span><span class="n">central_value</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_sm</span> <span class="o">=</span> <span class="n">info</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_sm</span>

    <span class="k">def</span> <span class="nf">get_wilson</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wc_dict</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Wilson</span><span class="p">(</span><span class="n">wc_dict</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">eft</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eft</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the log-likelihood as a dictionary for an instance of</span>
<span class="sd">        `wilson.Wilson`.&quot;&quot;&quot;</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ll</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">flh</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">lh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ll</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">lh</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">clh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ll</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">clh</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ll</span>

    <span class="nd">@dispatch</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">parameter_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wc_dict</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Choose a point in parameter space by providing a dictionary of</span>
<span class="sd">        Wilson coefficient values (with keys corresponding to WCxf Wilson</span>
<span class="sd">        coefficient names) and the input scale.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">scale</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You need to provide a scale&quot;</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wilson</span><span class="p">(</span><span class="n">wc_dict</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GlobalLikelihoodPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">fix_ckm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">)</span>

    <span class="nd">@dispatch</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">parameter_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wc_dict</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Choose a point in parameter space by providing a dictionary of</span>
<span class="sd">        Wilson coefficient values (with keys corresponding to WCxf Wilson</span>
<span class="sd">        coefficient names) and the input scale.&quot;&quot;&quot;</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wilson</span><span class="p">(</span><span class="n">wc_dict</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GlobalLikelihoodPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">fix_ckm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">)</span>

    <span class="nd">@dispatch</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">parameter_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Choose a point in parameter space by providing the path to a WCxf</span>
<span class="sd">        file.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">wc</span> <span class="o">=</span> <span class="n">wcxf</span><span class="o">.</span><span class="n">WC</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">Wilson</span><span class="o">.</span><span class="n">from_wc</span><span class="p">(</span><span class="n">wc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GlobalLikelihoodPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">fix_ckm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">)</span>

    <span class="nd">@dispatch</span><span class="p">(</span><span class="n">Wilson</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">parameter_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Choose a point in parameter space by providing an instance</span>
<span class="sd">        of `wilson.Wilson`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GlobalLikelihoodPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">fix_ckm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_inspire_dict</span><span class="p">(</span><span class="n">observables</span><span class="p">,</span> <span class="n">ml</span><span class="p">):</span>
        <span class="n">inspire_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">obs_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">observables</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">m_name</span> <span class="ow">in</span> <span class="n">ml</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
            <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">m_name</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">obs_set</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">inspire_dict</span><span class="p">:</span>
                    <span class="n">inspire_dict</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">inspire</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">inspire_dict</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">m_obj</span><span class="o">.</span><span class="n">inspire</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">inspire_dict</span>

    <span class="k">def</span> <span class="nf">number_observations_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a dictionary of the number of &quot;observations&quot; for each</span>
<span class="sd">        sublikelihood.</span>

<span class="sd">        Here, an &quot;observation&quot; is defined as an individual measurment</span>
<span class="sd">        of an observable. Thus, the number of observations is always</span>
<span class="sd">        &gt;= the number of observables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nobs_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">nobs_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">flh</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude_observables</span> <span class="ow">or</span> <span class="p">[]))</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">lh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ml</span> <span class="o">=</span>  <span class="n">lh</span><span class="o">.</span><span class="n">measurement_likelihood</span>
            <span class="n">nobs_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">get_number_observations</span><span class="p">(</span>
                <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">clh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">nobs_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">clh</span><span class="o">.</span><span class="n">get_number_observations</span><span class="p">()</span>
        <span class="n">nobs_dict</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">nobs_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;custom_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">nobs_dict</span>

    <span class="k">def</span> <span class="nf">plot_data_2d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">wc_fct</span><span class="p">,</span>
                     <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span>
                     <span class="n">scale</span><span class="p">,</span>
                     <span class="n">steps</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                     <span class="n">threads</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the likelihood on a grid of two non-zero Wilson coefficients.</span>

<span class="sd">        This method is meant for producing contour plots with `flavio.plots`</span>
<span class="sd">        and `matplotlib` in the plane of two Wilson coefficients.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        - `wc_fct`: function of two parameters x and y returning a dictionary</span>
<span class="sd">                    with Wilson coefficients</span>
<span class="sd">        - `x_min`: minimum value of Wilson coefficient on x axis</span>
<span class="sd">        - `x_max`: maximum value of Wilson coefficient on x axis</span>
<span class="sd">        - `y_min`: minimum value of Wilson coefficient on y axis</span>
<span class="sd">        - `y_max`: maximum value of Wilson coefficient on y axis</span>
<span class="sd">        - `scale`: either a function of two parameters x and y returning the</span>
<span class="sd">                   renormalization scale in GeV, or a numerical value fixing the</span>
<span class="sd">                   scale</span>
<span class="sd">        - `steps`: number of steps in each direction. The computing time scales</span>
<span class="sd">                   with the square of this number.</span>
<span class="sd">        - `threads`: number of threads for parallel computation (default: 1)</span>

<span class="sd">        Returns:</span>

<span class="sd">        A dictionary of the  form</span>
<span class="sd">        `{&#39;likelihood_A&#39;: dat_A, &#39;likelihood_B&#39;: dat_B, ...}`</span>
<span class="sd">        where `&#39;likelihood_A&#39;` etc. are the names of the sub- and custom</span>
<span class="sd">        likelihoods (as return by `GlobalLikelihoodPoint.log_likelihood_dict`)</span>
<span class="sd">        and `dat_A` etc. are dictionaries with the keys `x`, `y`, `z`, that</span>
<span class="sd">        can be directly fed to the `flavio.plots.contour` plot function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
        <span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">)</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">steps</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">xy_enumerated</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">xy</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span><span class="n">Number</span><span class="p">):</span>
            <span class="n">scale_fct</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">_scale_fct_fixed</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale_fct</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">_log_likelihood_2d</span><span class="p">,</span> <span class="n">gl</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">wc_fct</span><span class="o">=</span><span class="n">wc_fct</span><span class="p">,</span> <span class="n">scale_fct</span><span class="o">=</span><span class="n">scale_fct</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
        <span class="k">if</span> <span class="n">threads</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pool</span> <span class="o">=</span>  <span class="n">Pool</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span>
            <span class="n">ll_dict_list_enumerated</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="n">xy_enumerated</span><span class="p">)</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ll_dict_list_enumerated</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="n">xy_enumerated</span><span class="p">)</span>
        <span class="n">ll_dict_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ll_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ll_dict</span> <span class="ow">in</span>
            <span class="nb">sorted</span><span class="p">(</span><span class="n">ll_dict_list_enumerated</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="p">]</span>
        <span class="n">plotdata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">ll_dict_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>  <span class="c1"># look at first dict to fix keys</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ll_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">ll_dict</span> <span class="ow">in</span> <span class="n">ll_dict_list</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">steps</span><span class="p">,</span> <span class="n">steps</span><span class="p">))</span>
            <span class="n">plotdata</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="n">z</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">plotdata</span>

<span class="k">def</span> <span class="nf">_scale_fct_fixed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a helper function that is necessary because multiprocessing requires</span>
<span class="sd">    a picklable (i.e. top-level) object for parallel computation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">scale</span>

<span class="k">def</span> <span class="nf">_log_likelihood_2d</span><span class="p">(</span><span class="n">xy_enumerated</span><span class="p">,</span> <span class="n">gl</span><span class="p">,</span> <span class="n">wc_fct</span><span class="p">,</span> <span class="n">scale_fct</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the likelihood on a 2D grid of 2 Wilson coefficients.</span>

<span class="sd">    This function is necessary because multiprocessing requires a picklable</span>
<span class="sd">    (i.e. top-level) object for parallel computation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="n">xy_enumerated</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">xy</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">parameter_point</span><span class="p">(</span><span class="n">wc_fct</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">scale_fct</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    <span class="n">ll_dict</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">log_likelihood_dict</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">ll_dict</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CustomLikelihood</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">,</span> <span class="n">observables</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span> <span class="o">=</span> <span class="n">likelihood</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">observables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclude_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_exclude_obs_dict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_exclude_obs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a dictionary with observables to be excluded from each</span>
<span class="sd">        (Fast)Likelihood instance.&quot;&quot;&quot;</span>
        <span class="n">exclude_obs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">lhs_or_flhs</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">likelihoods</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">lh_name</span><span class="p">,</span> <span class="n">lh</span> <span class="ow">in</span> <span class="n">lhs_or_flhs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">exclude_observables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">lh</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">lh</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">!=</span> <span class="n">exclude_observables</span><span class="p">:</span>
                    <span class="n">exclude_obs</span><span class="p">[</span><span class="n">lh_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">exclude_observables</span>
        <span class="k">return</span> <span class="n">exclude_obs</span>

    <span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">custom_log_likelihood</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">lh_name</span><span class="p">,</span> <span class="n">exclude_observables</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude_obs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">lh</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lh_name</span><span class="p">)</span>
                  <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lh_name</span><span class="p">))</span>
            <span class="n">custom_log_likelihood</span> <span class="o">+=</span> <span class="n">lh</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span>
                <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">,</span>
                <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">custom_log_likelihood</span>

    <span class="k">def</span> <span class="nf">get_number_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the number of observations, defined as individual measurements</span>
<span class="sd">        of observables.&quot;&quot;&quot;</span>
        <span class="n">nobs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">llh_name</span><span class="p">,</span> <span class="n">exclude_observables</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude_obs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">llh_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="p">:</span>
                <span class="n">flh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="p">[</span><span class="n">llh_name</span><span class="p">]</span>
                <span class="n">nobs</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">flh</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude_observables</span> <span class="ow">or</span> <span class="p">[]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">likelihoods</span><span class="p">[</span><span class="n">llh_name</span><span class="p">]</span>
                <span class="n">ml</span> <span class="o">=</span>  <span class="n">lh</span><span class="o">.</span><span class="n">measurement_likelihood</span>
                <span class="n">nobs</span> <span class="o">+=</span> <span class="n">ml</span><span class="o">.</span><span class="n">get_number_observations</span><span class="p">(</span>
                    <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nobs</span>


<span class="k">class</span> <span class="nc">GlobalLikelihoodPoint</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class representing the properties of the likelihood function at a</span>
<span class="sd">    specific point in parameter space.</span>

<span class="sd">    Attributes:</span>

<span class="sd">    - `log_likelihood_dict`: dictionary with individual contributions</span>
<span class="sd">    to the log-likelihood</span>
<span class="sd">    - `value`: Return the numerical values of the global log-likelihood</span>
<span class="sd">    compared to the SM value (can also be acessed with `float(self)`)</span>

<span class="sd">    Methods:</span>

<span class="sd">    - `get_obstable`: return a pandas data frame with the values and pulls</span>
<span class="sd">    for each individual observable, given the Wilson coefficients</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span>
                 <span class="n">fix_ckm</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the `GlobalLikelihoodPoint` instance.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - likelihood: an instance of `GlobalLikelihood`</span>
<span class="sd">        - w: an instance of `wilson.Wilson`</span>
<span class="sd">        - fix_ckm: If False (default), automatically determine the CKM elements</span>
<span class="sd">          in the presence of new physics in processes used to determine these</span>
<span class="sd">          elements in the SM. If set to True, the CKM elements are fixed to</span>
<span class="sd">          their SM values, which can lead to inconsistent results, but also</span>
<span class="sd">          to a significant speedup in specific cases.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span> <span class="o">=</span> <span class="n">likelihood</span>
        <span class="n">likelihood</span><span class="o">.</span><span class="n">_check_sm_cov_loaded</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w_input</span> <span class="o">=</span> <span class="n">w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span> <span class="o">=</span> <span class="n">fix_ckm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_w</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_tree_cache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_par_dict_np</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">w</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_input</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;parameters&#39;</span><span class="p">)</span>
            <span class="n">par</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_dict_np</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Vus&#39;</span><span class="p">,</span> <span class="s1">&#39;Vcb&#39;</span><span class="p">,</span> <span class="s1">&#39;Vub&#39;</span><span class="p">,</span> <span class="s1">&#39;delta&#39;</span><span class="p">]:</span>
                <span class="n">opt</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
            <span class="n">w</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;parameters&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_w</span> <span class="o">=</span> <span class="n">w</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_w</span>

    <span class="k">def</span> <span class="nf">get_ckm_np</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return the values of the four &quot;true&quot; CKM parameters</span>
<span class="sd">        `Vus`, `Vcb`, `Vub`, `delta`, extracted from the four input observables</span>
<span class="sd">        for this parameter point in Wilson coefficient space.&quot;&quot;&quot;</span>
        <span class="n">scheme</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">_ckm_scheme</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Vus</span><span class="p">,</span> <span class="n">Vcb</span><span class="p">,</span> <span class="n">Vub</span><span class="p">,</span> <span class="n">delta</span> <span class="o">=</span> <span class="n">scheme</span><span class="o">.</span><span class="n">ckm_np</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_input</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># this happens mostly when the formulas result in |cos(delta)| &gt; 1</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The extraction of CKM elements failed. Too large NP effects?&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Vus&#39;</span><span class="p">:</span> <span class="n">Vus</span><span class="p">,</span> <span class="s1">&#39;Vcb&#39;</span><span class="p">:</span> <span class="n">Vcb</span><span class="p">,</span> <span class="s1">&#39;Vub&#39;</span><span class="p">:</span> <span class="n">Vub</span><span class="p">,</span> <span class="s1">&#39;delta&#39;</span><span class="p">:</span> <span class="n">delta</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">par_dict_np</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the dictionary of parameters where the four CKM parameters</span>
<span class="sd">        `Vus`, `Vcb`, `Vub`, `delta` have been replaced by their</span>
<span class="sd">        &quot;true&quot; values as extracted from the four input observables.</span>

<span class="sd">        Note that if `fix_ckm` is set to `True`, this method actually</span>
<span class="sd">        returns the SM values.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">par_dict_sm</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_par_dict_np</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">par_dict_np</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">par_dict_default</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">par_dict_np</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_ckm_np</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_par_dict_np</span> <span class="o">=</span> <span class="n">par_dict_np</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_par_dict_np</span>

    <span class="k">def</span> <span class="nf">_delta_log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the delta log likelihood for the individual likelihoods&quot;&quot;&quot;</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">_log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_dict_np</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
            <span class="n">ll</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">log_likelihood_sm</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">ll</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ll</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;custom_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">ll</span>

    <span class="k">def</span> <span class="nf">log_likelihood_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a dictionary with the delta log likelihood values</span>
<span class="sd">        for the individual contributions.</span>

<span class="sd">        Cached after the first call.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta_log_likelihood</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_dict</span>

    <span class="k">def</span> <span class="nf">log_likelihood_global</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the value of the global delta log likelihood.</span>

<span class="sd">        Cached after the first call. Corresponds to the `global` key of</span>
<span class="sd">        the dictionary returned by `log_likelihood_dict`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_dict</span><span class="p">()[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">pvalue_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_par</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Dictionary of $p$ values of sublikelihoods given the number `n_par`</span>
<span class="sd">        of free parameters (default 0).&quot;&quot;&quot;</span>
        <span class="n">nobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">number_observations_dict</span><span class="p">()</span>
        <span class="n">chi2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chi2_dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">pvalue</span><span class="p">(</span><span class="n">chi2</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">dof</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nobs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">n_par</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">chi2</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">chi2_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Dictionary of total $\chi^2$ values of each sublikelihood.</span>

<span class="sd">        $$\chi^2 = -2 (\ln L + \ln L_\text{SM})$$</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_dict</span><span class="p">()</span>
        <span class="n">llsm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">_log_likelihood_sm</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">llsm</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">llsm</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;custom_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ll</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">llsm</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_obstable_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_tree_cache</span><span class="p">:</span>
            <span class="n">llh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">llh</span><span class="o">.</span><span class="n">obstable_sm</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">flh_name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="n">llh</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># loop over fast likelihoods: they only have a single &quot;measurement&quot;</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">flh</span><span class="o">.</span><span class="n">pseudo_measurement</span>
                <span class="n">ml</span> <span class="o">=</span> <span class="n">flh</span><span class="o">.</span><span class="n">full_measurement_likelihood</span>
                <span class="n">pred</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">get_predictions_par</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_dict_np</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">flh</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;theory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span>
                    <span class="n">ll_central</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;ll_central&#39;</span><span class="p">]</span>
                    <span class="n">ll_sm</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;ll_sm&#39;</span><span class="p">]</span>
                    <span class="n">ll</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_logprobability_single</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">pred</span><span class="p">[</span><span class="n">obs</span><span class="p">])</span>
                    <span class="c1"># DeltaChi2 is -2*DeltaLogLikelihood</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;pull exp.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pull</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ll</span> <span class="o">-</span> <span class="n">ll_central</span><span class="p">),</span> <span class="n">dof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">ll</span> <span class="o">&gt;</span> <span class="n">ll_sm</span> <span class="k">else</span> <span class="mi">1</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;pull SM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">pull</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ll</span> <span class="o">-</span> <span class="n">ll_sm</span><span class="p">),</span> <span class="n">dof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">lh_name</span><span class="p">,</span> <span class="n">lh</span> <span class="ow">in</span> <span class="n">llh</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># loop over &quot;normal&quot; likelihoods</span>
                <span class="n">ml</span> <span class="o">=</span> <span class="n">lh</span><span class="o">.</span><span class="n">measurement_likelihood</span>
                <span class="n">pred</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">get_predictions_par</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_dict_np</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lh</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;theory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span>
                    <span class="n">ll_central</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;ll_central&#39;</span><span class="p">]</span>
                    <span class="n">ll_sm</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;ll_sm&#39;</span><span class="p">]</span>
                    <span class="n">p_comb</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;exp. PDF&#39;</span><span class="p">]</span>
                    <span class="n">ll</span> <span class="o">=</span> <span class="n">p_comb</span><span class="o">.</span><span class="n">logpdf</span><span class="p">([</span><span class="n">pred</span><span class="p">[</span><span class="n">obs</span><span class="p">]])</span>
                    <span class="k">if</span> <span class="n">ll</span> <span class="o">==</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
                        <span class="n">ll</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1e100</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;pull exp.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pull</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ll</span> <span class="o">-</span> <span class="n">ll_central</span><span class="p">),</span> <span class="n">dof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">ll</span> <span class="o">&gt;</span> <span class="n">ll_sm</span> <span class="k">else</span> <span class="mi">1</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;pull SM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">pull</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ll</span> <span class="o">-</span> <span class="n">ll_sm</span><span class="p">),</span> <span class="n">dof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_tree_cache</span> <span class="o">=</span> <span class="n">info</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_tree_cache</span>

    <span class="k">def</span> <span class="nf">obstable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_pull_exp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s1">&#39;pull exp.&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">min_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return a pandas data frame with the central values and uncertainties</span>
<span class="sd">        as well as the pulls with respect to the experimental and the SM values for each observable.</span>

<span class="sd">        The pull is defined is $\sqrt(|-2\ln L|)$. Note that the global</span>
<span class="sd">        likelihood is *not* simply proportional to the sum of squared pulls</span>
<span class="sd">        due to correlations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sort_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;exp. unc.&#39;</span><span class="p">,</span> <span class="s1">&#39;experiment&#39;</span><span class="p">,</span> <span class="s1">&#39;pull SM&#39;</span><span class="p">,</span> <span class="s1">&#39;pull exp.&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;th. unc.&#39;</span><span class="p">,</span> <span class="s1">&#39;theory&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">sort_by</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sort_keys</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; is not an allowed value for sort_by. Allowed values are &quot;</span>
                <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39;, and &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sort_by</span><span class="p">,</span> <span class="s2">&quot;&#39;, &#39;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sort_keys</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                                         <span class="n">sort_keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_tree</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">sort_by</span> <span class="o">==</span> <span class="s1">&#39;pull exp.&#39;</span><span class="p">:</span>
            <span class="c1"># if sorted by pull exp., use descending order as default</span>
            <span class="k">if</span> <span class="n">ascending</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">min_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">min_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_pull_exp</span><span class="p">,</span> <span class="n">min_val</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">min_val</span> <span class="o">=</span> <span class="n">min_pull_exp</span>
        <span class="k">elif</span> <span class="n">min_pull_exp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">subset</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;pull exp.&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_pull_exp</span>
        <span class="c1"># if sorted not by pull exp., use ascending order as default</span>
        <span class="k">if</span> <span class="n">ascending</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ascending</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_filter_sort</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">sortkey</span><span class="o">=</span><span class="n">sort_by</span><span class="p">,</span>
                                          <span class="n">ascending</span><span class="o">=</span><span class="n">ascending</span><span class="p">,</span>
                                          <span class="n">min_val</span><span class="o">=</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="n">max_val</span><span class="p">,</span>
                                          <span class="n">subset</span><span class="o">=</span><span class="n">subset</span><span class="p">)</span>
        <span class="c1"># create DataFrame</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">info</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># if df has length 0 (e.g. if min_pull is very large) there are no</span>
        <span class="c1"># columns that could be removed</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="c1"># remove columns that are only used internal and should not be</span>
            <span class="c1"># included in obstable</span>
            <span class="k">del</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;inspire&#39;</span><span class="p">])</span>
            <span class="k">del</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;lh_name&#39;</span><span class="p">])</span>
            <span class="k">del</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="k">del</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;exp. PDF&#39;</span><span class="p">])</span>
            <span class="k">del</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ll_central&#39;</span><span class="p">])</span>
            <span class="k">del</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ll_sm&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_obstable_filter_sort</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">sortkey</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">min_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">subset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_rows</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># impose min_val and max_val</span>
        <span class="k">if</span> <span class="n">min_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="n">obs</span><span class="p">:</span><span class="n">row</span> <span class="k">for</span> <span class="n">obs</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="n">sortkey</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_val</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">max_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="n">obs</span><span class="p">:</span><span class="n">row</span> <span class="k">for</span> <span class="n">obs</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="n">sortkey</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">max_val</span><span class="p">}</span>
        <span class="c1"># get only subset:</span>
        <span class="k">if</span> <span class="n">subset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="n">obs</span><span class="p">:</span><span class="n">row</span> <span class="k">for</span> <span class="n">obs</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">subset</span><span class="p">(</span><span class="n">row</span><span class="p">)}</span>
        <span class="c1"># sort</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">sortkey</span><span class="p">],</span>
                                  <span class="n">reverse</span><span class="o">=</span><span class="p">(</span><span class="ow">not</span> <span class="n">ascending</span><span class="p">)))</span>
        <span class="c1"># restrict number of rows per tabular to max_rows</span>
        <span class="k">if</span> <span class="n">max_rows</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">max_rows</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">info</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">info_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span><span class="o">/</span><span class="n">max_rows</span><span class="p">)):</span>
                <span class="n">info_n</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">obs</span><span class="p">,</span><span class="n">row</span><span class="p">)</span>
                                    <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">obs</span><span class="p">,</span><span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                                    <span class="k">if</span> <span class="n">i</span><span class="o">&gt;=</span><span class="n">n</span><span class="o">*</span><span class="n">max_rows</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">max_rows</span><span class="p">)</span>
                <span class="n">info_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info_n</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">info_list</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">


    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="smelli.classes.CustomLikelihood" class="name">class <span class="ident">CustomLikelihood</span></p>
      
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.CustomLikelihood', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.CustomLikelihood" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">CustomLikelihood</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">,</span> <span class="n">observables</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span> <span class="o">=</span> <span class="n">likelihood</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">observables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclude_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_exclude_obs_dict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_exclude_obs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a dictionary with observables to be excluded from each</span>
<span class="sd">        (Fast)Likelihood instance.&quot;&quot;&quot;</span>
        <span class="n">exclude_obs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">lhs_or_flhs</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">likelihoods</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">lh_name</span><span class="p">,</span> <span class="n">lh</span> <span class="ow">in</span> <span class="n">lhs_or_flhs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">exclude_observables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">lh</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">lh</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">!=</span> <span class="n">exclude_observables</span><span class="p">:</span>
                    <span class="n">exclude_obs</span><span class="p">[</span><span class="n">lh_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">exclude_observables</span>
        <span class="k">return</span> <span class="n">exclude_obs</span>

    <span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">custom_log_likelihood</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">lh_name</span><span class="p">,</span> <span class="n">exclude_observables</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude_obs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">lh</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lh_name</span><span class="p">)</span>
                  <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lh_name</span><span class="p">))</span>
            <span class="n">custom_log_likelihood</span> <span class="o">+=</span> <span class="n">lh</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span>
                <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">,</span>
                <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">custom_log_likelihood</span>

    <span class="k">def</span> <span class="nf">get_number_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the number of observations, defined as individual measurements</span>
<span class="sd">        of observables.&quot;&quot;&quot;</span>
        <span class="n">nobs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">llh_name</span><span class="p">,</span> <span class="n">exclude_observables</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude_obs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">llh_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="p">:</span>
                <span class="n">flh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="p">[</span><span class="n">llh_name</span><span class="p">]</span>
                <span class="n">nobs</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">flh</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude_observables</span> <span class="ow">or</span> <span class="p">[]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">likelihoods</span><span class="p">[</span><span class="n">llh_name</span><span class="p">]</span>
                <span class="n">ml</span> <span class="o">=</span>  <span class="n">lh</span><span class="o">.</span><span class="n">measurement_likelihood</span>
                <span class="n">nobs</span> <span class="o">+=</span> <span class="n">ml</span><span class="o">.</span><span class="n">get_number_observations</span><span class="p">(</span>
                    <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nobs</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#smelli.classes.CustomLikelihood">CustomLikelihood</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="smelli.classes.CustomLikelihood.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, likelihood, observables)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize self.  See help(type(self)) for accurate signature.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.CustomLikelihood.__init__', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.CustomLikelihood.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">,</span> <span class="n">observables</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span> <span class="o">=</span> <span class="n">likelihood</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">observables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">exclude_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_exclude_obs_dict</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smelli.classes.CustomLikelihood.get_number_observations">
    <p>def <span class="ident">get_number_observations</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Get the number of observations, defined as individual measurements
of observables.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.CustomLikelihood.get_number_observations', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.CustomLikelihood.get_number_observations" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_number_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the number of observations, defined as individual measurements</span>
<span class="sd">    of observables.&quot;&quot;&quot;</span>
    <span class="n">nobs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">llh_name</span><span class="p">,</span> <span class="n">exclude_observables</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude_obs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">llh_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="p">:</span>
            <span class="n">flh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="p">[</span><span class="n">llh_name</span><span class="p">]</span>
            <span class="n">nobs</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">flh</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude_observables</span> <span class="ow">or</span> <span class="p">[]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">likelihoods</span><span class="p">[</span><span class="n">llh_name</span><span class="p">]</span>
            <span class="n">ml</span> <span class="o">=</span>  <span class="n">lh</span><span class="o">.</span><span class="n">measurement_likelihood</span>
            <span class="n">nobs</span> <span class="o">+=</span> <span class="n">ml</span><span class="o">.</span><span class="n">get_number_observations</span><span class="p">(</span>
                <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nobs</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smelli.classes.CustomLikelihood.log_likelihood">
    <p>def <span class="ident">log_likelihood</span>(</p><p>self, par_dict, wc_obj, delta=False)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.CustomLikelihood.log_likelihood', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.CustomLikelihood.log_likelihood" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">custom_log_likelihood</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">lh_name</span><span class="p">,</span> <span class="n">exclude_observables</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude_obs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">lh</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lh_name</span><span class="p">)</span>
              <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lh_name</span><span class="p">))</span>
        <span class="n">custom_log_likelihood</span> <span class="o">+=</span> <span class="n">lh</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span>
            <span class="n">par_dict</span><span class="p">,</span> <span class="n">wc_obj</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">,</span>
            <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">custom_log_likelihood</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="smelli.classes.CustomLikelihood.exclude_obs" class="name">var <span class="ident">exclude_obs</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smelli.classes.CustomLikelihood.likelihood" class="name">var <span class="ident">likelihood</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smelli.classes.CustomLikelihood.observables" class="name">var <span class="ident">observables</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="smelli.classes.GlobalLikelihood" class="name">class <span class="ident">GlobalLikelihood</span></p>
      
  
    <div class="desc"><p>Class that provides a global likelihood in SMEFT Wilson
coefficient space.</p>
<p>User methods:</p>
<ul>
<li><code>log_likelihood</code>: return an instance of LieklihoodResult
given a dictionary of Wilson coefficients at a given scale</li>
<li><code>log_likelihood_wcxf</code>: return an instance of LieklihoodResult
given the path to a WCxf file</li>
<li><code>log_likelihood_wilson</code>: return an instance of LieklihoodResult+
given an instance of <code>wilson.Wilson</code></li>
</ul>
<p>Utility methods:</p>
<ul>
<li><code>make_measurement</code>: compute the SM covariances. Note that it is only
necessary to call this method when changes to the default
parameters/uncertainties have been made</li>
<li><code>save_sm_covariances</code>, <code>load_sm_covariances</code>: Save the calculated SM
covariances or load them from data files</li>
<li><code>save_exp_covariances</code>, <code>load_exp_covariances</code>: Save the calculated
experimental central values and covariances or load them from data files</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.GlobalLikelihood', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.GlobalLikelihood" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">GlobalLikelihood</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class that provides a global likelihood in SMEFT Wilson</span>
<span class="sd">    coefficient space.</span>

<span class="sd">    User methods:</span>

<span class="sd">    - `log_likelihood`: return an instance of LieklihoodResult</span>
<span class="sd">    given a dictionary of Wilson coefficients at a given scale</span>
<span class="sd">    - `log_likelihood_wcxf`: return an instance of LieklihoodResult</span>
<span class="sd">    given the path to a WCxf file</span>
<span class="sd">    - `log_likelihood_wilson`: return an instance of LieklihoodResult+</span>
<span class="sd">    given an instance of `wilson.Wilson`</span>

<span class="sd">    Utility methods:</span>

<span class="sd">    - `make_measurement`: compute the SM covariances. Note that it is only</span>
<span class="sd">    necessary to call this method when changes to the default</span>
<span class="sd">    parameters/uncertainties have been made</span>
<span class="sd">    - `save_sm_covariances`, `load_sm_covariances`: Save the calculated SM</span>
<span class="sd">    covariances or load them from data files</span>
<span class="sd">    - `save_exp_covariances`, `load_exp_covariances`: Save the calculated</span>
<span class="sd">    experimental central values and covariances or load them from data files</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_default_bases</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;SMEFT&#39;</span><span class="p">:</span> <span class="s1">&#39;Warsaw&#39;</span><span class="p">,</span> <span class="s1">&#39;WET&#39;</span><span class="p">:</span> <span class="s1">&#39;flavio&#39;</span><span class="p">}</span>

    <span class="n">_fast_likelihoods_yaml_fixckm</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;fast_likelihood_quarks_fixckm.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fast_likelihood_leptons.yaml&#39;</span>
    <span class="p">]</span>

    <span class="n">_fast_likelihoods_yaml</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;fast_likelihood_quarks.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fast_likelihood_leptons.yaml&#39;</span>
    <span class="p">]</span>

    <span class="n">_likelihoods_yaml</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;likelihood_ewpt.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood_eeww.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood_lept.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood_rd_rds.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood_lfu_fccc.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood_lfu_fcnc.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood_bcpv.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood_bqnunu.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood_lfv.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood_zlfv.yaml&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood_higgs.yaml&#39;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eft</span><span class="o">=</span><span class="s1">&#39;SMEFT&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">par_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">include_likelihoods</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">exclude_likelihoods</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">Nexp</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
                 <span class="n">exp_cov_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">sm_cov_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">custom_likelihoods</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">fix_ckm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">ckm_scheme</span><span class="o">=</span><span class="s1">&#39;CKMSchemeRmuBtaunuBxlnuDeltaM&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the likelihood.</span>

<span class="sd">        Optionally, a dictionary of parameters can be passed as `par_dict`.</span>
<span class="sd">        If not given (or not complete), flavio default parameter values will</span>
<span class="sd">        be used. Note that the CKM elements in `par_dict` will be ignored as</span>
<span class="sd">        the &quot;true&quot; CKM elements will be extracted for each parameter point</span>
<span class="sd">        from the measurement of four input observables:</span>
<span class="sd">        - `&#39;RKpi(P+-&gt;munu)&#39;`</span>
<span class="sd">        - `&#39;BR(B+-&gt;taunu)&#39;`</span>
<span class="sd">        - `&#39;BR(B-&gt;Xcenu)&#39;`</span>
<span class="sd">        - `&#39;DeltaM_d/DeltaM_s&#39;`</span>

<span class="sd">        Parameters:</span>

<span class="sd">        - eft: a WCxf EFT, must be one of &#39;SMEFT&#39; (default) or &#39;WET&#39;.</span>
<span class="sd">        - basis: a WCxf basis, defaults to &#39;Warsaw&#39; for SMEFT and &#39;flavio&#39;</span>
<span class="sd">          for WET.</span>
<span class="sd">        - include_likelihoods: a list of strings specifying the likelihoods</span>
<span class="sd">          to be included (default: all of them). Note that this cannot be used</span>
<span class="sd">          to add likelihoods.</span>
<span class="sd">        - exclude_likelihoods: a list of strings specifying the likelihoods</span>
<span class="sd">          to be excluded (default: none of them).</span>
<span class="sd">        - Nexp: number of random evaluations of the experimental likelihood</span>
<span class="sd">          used to extract the covariance matrix for &quot;fast likelihood&quot;</span>
<span class="sd">          instances. Defaults to 5000.</span>
<span class="sd">        - exp_cov_folder: directory containing saved expererimental</span>
<span class="sd">          covariances. The data files have to be in the format exported by</span>
<span class="sd">          `save_exp_covariances`.</span>
<span class="sd">        - sm_cov_folder: directory containing saved SM</span>
<span class="sd">          covariances. The data files have to be in the format exported by</span>
<span class="sd">          `save_sm_covariances`.</span>
<span class="sd">        - custom_likelihoods: a dictionary in which each value is a list of</span>
<span class="sd">          observables and each key is a string that serves as user-defined</span>
<span class="sd">          name. For each item of the dictionary, a custom likelihood will be</span>
<span class="sd">          computed.</span>
<span class="sd">        - fix_ckm: If False (default), automatically determine the CKM elements</span>
<span class="sd">          in the presence of new physics in processes used to determine these</span>
<span class="sd">          elements in the SM. If set to True, the CKM elements are fixed to</span>
<span class="sd">          their SM values, which can lead to inconsistent results, but also</span>
<span class="sd">          to a significant speedup in specific cases.</span>
<span class="sd">        - ckm_scheme: A string with the name of the class defining the CKM</span>
<span class="sd">          scheme.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eft</span> <span class="o">=</span> <span class="n">eft</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">basis</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_bases</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eft</span><span class="p">]</span>
        <span class="n">par_dict</span> <span class="o">=</span> <span class="n">par_dict</span> <span class="ow">or</span> <span class="p">{}</span>  <span class="c1"># initialize empty if not given</span>
        <span class="c1"># take missing parameters from flavio defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_dict_default</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">default_parameters</span><span class="o">.</span><span class="n">get_central_all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par_dict_default</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">par_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_par_dict_sm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span> <span class="o">=</span> <span class="n">fix_ckm</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fast_likelihoods_yaml</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fast_likelihoods_yaml_fixckm</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ckm_scheme</span> <span class="o">=</span> <span class="n">get_ckm_schemes</span><span class="p">()[</span><span class="n">ckm_scheme</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ckm_scheme_name</span> <span class="o">=</span> <span class="n">ckm_scheme</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CKM scheme &#39;</span><span class="si">{}</span><span class="s2">&#39; is not defined.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ckm_scheme</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">likelihoods</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_custom_likelihoods_dict</span> <span class="o">=</span> <span class="n">custom_likelihoods</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_likelihoods</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_likelihoods</span><span class="p">(</span><span class="n">include_likelihoods</span><span class="o">=</span><span class="n">include_likelihoods</span><span class="p">,</span>
                               <span class="n">exclude_likelihoods</span><span class="o">=</span><span class="n">exclude_likelihoods</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Nexp</span> <span class="o">=</span> <span class="n">Nexp</span>
        <span class="k">if</span> <span class="n">exp_cov_folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_exp_covariances</span><span class="p">(</span><span class="n">exp_cov_folder</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sm_cov_loaded</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sm_cov_folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_sm_covariances</span><span class="p">(</span><span class="n">get_datapath</span><span class="p">(</span><span class="s1">&#39;smelli&#39;</span><span class="p">,</span> <span class="s1">&#39;data/cache&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_sm_covariances</span><span class="p">(</span><span class="n">sm_cov_folder</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sm_cov_loaded</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">make_measurement</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;There was a problem loading the SM covariances. &quot;</span>
                          <span class="s2">&quot;Please recompute them with `make_measurement`.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_sm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_sm</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_load_likelihoods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">include_likelihoods</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">exclude_likelihoods</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">include_likelihoods</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">exclude_likelihoods</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;include_likelihoods and exclude_likelihoods &quot;</span>
                             <span class="s2">&quot;should not be specified simultaneously.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">argument_name</span><span class="p">,</span> <span class="n">argument</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;exclude_likelihoods&#39;</span><span class="p">,</span> <span class="n">exclude_likelihoods</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;include_likelihoods&#39;</span><span class="p">,</span><span class="n">include_likelihoods</span><span class="p">)]:</span>
            <span class="k">if</span> <span class="n">argument</span><span class="p">:</span>
                <span class="n">unknown_likelihoods</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fast_likelihoods_yaml</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_likelihoods_yaml</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">unknown_likelihoods</span><span class="p">:</span>  
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> contains unknown likelihoods: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">argument_name</span><span class="p">,</span><span class="n">unknown_likelihoods</span><span class="p">))</span>
        <span class="c1"># load ckm parameters for given CKM scheme</span>
        <span class="n">par_ckm_file</span> <span class="o">=</span> <span class="s1">&#39;par_ckm_</span><span class="si">{}</span><span class="s1">.yaml&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ckm_scheme_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_yaml_path</span><span class="p">(</span><span class="n">par_ckm_file</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">par_ckm_dict</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">load_include</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fast_likelihoods_yaml</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">include_likelihoods</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fn</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">include_likelihoods</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">exclude_likelihoods</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">exclude_likelihoods</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_yaml_path</span><span class="p">(</span><span class="n">fn</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">yaml_dict</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">load_include</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">:</span>
                    <span class="n">yaml_dict</span><span class="p">[</span><span class="s1">&#39;par_obj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">par_ckm_dict</span>
                <span class="n">L</span> <span class="o">=</span> <span class="n">FastLikelihood</span><span class="o">.</span><span class="n">load_dict</span><span class="p">(</span><span class="n">yaml_dict</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_likelihoods_yaml</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">include_likelihoods</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fn</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">include_likelihoods</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">exclude_likelihoods</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">exclude_likelihoods</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eft</span> <span class="o">!=</span> <span class="s1">&#39;SMEFT&#39;</span> <span class="ow">and</span> <span class="n">fn</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;likelihood_ewpt.yaml&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;likelihood_eeww.yaml&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;likelihood_zlfv.yaml&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;likelihood_higgs.yaml&#39;</span><span class="p">,]:</span>
                <span class="k">continue</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_yaml_path</span><span class="p">(</span><span class="n">fn</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">L</span> <span class="o">=</span> <span class="n">Likelihood</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">likelihoods</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">observables</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_custom_likelihoods_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">CustomLikelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observables</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">custom_likelihoods</span><span class="p">[</span><span class="s1">&#39;custom_&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span>

    <span class="k">def</span> <span class="nf">_get_yaml_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a path for the YAML file specified by `name`.</span>
<span class="sd">        If a YAML file with that name is found in the package&#39;s data</span>
<span class="sd">        directory, that is used. Otherwise, `name` is assumed to be a path.</span>

<span class="sd">        Raises `FileNotFoundError` if path does not exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">get_datapath</span><span class="p">(</span><span class="s1">&#39;smelli&#39;</span><span class="p">,</span> <span class="s1">&#39;data/yaml/&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">path</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">get_datapath</span><span class="p">(</span><span class="s1">&#39;smelli&#39;</span><span class="p">,</span> <span class="s1">&#39;data/yaml/&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.yaml&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">path</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.yaml&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.yaml&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Likelihood YAML file &#39;</span><span class="si">{}</span><span class="s2">&#39; was not found&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">make_measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the likelihood by producing a pseudo-measurement containing both</span>
<span class="sd">        experimental uncertainties as well as theory uncertainties stemming</span>
<span class="sd">        from nuisance parameters.</span>

<span class="sd">        Optional parameters:</span>

<span class="sd">        - `N`: number of random computations for the SM covariance (computing</span>
<span class="sd">          time is proportional to it; more means less random fluctuations.)</span>
<span class="sd">        - `Nexp`: number of random computations for the experimental covariance.</span>
<span class="sd">          This is much less expensive than the theory covariance, so a large</span>
<span class="sd">          number can be afforded (default: 5000).</span>
<span class="sd">        - `threads`: number of parallel threads for the SM</span>
<span class="sd">          covariance computation. Defaults to 1 (no parallelization).</span>
<span class="sd">        - `force`: if True, will recompute SM covariance even if it</span>
<span class="sd">          already has been computed. Defaults to False.</span>
<span class="sd">        - `force_exp`: if True, will recompute experimental central values and</span>
<span class="sd">          covariance even if they have already been computed. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;Nexp&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Nexp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Nexp</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">flh</span><span class="o">.</span><span class="n">make_measurement</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sm_cov_loaded</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">save_sm_covariances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_fix_ckm&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ckm_scheme_name</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.p&#39;</span><span class="p">)</span>
            <span class="n">flh</span><span class="o">.</span><span class="n">sm_covariance</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_sm_covariances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_fix_ckm&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ckm_scheme_name</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.p&#39;</span><span class="p">)</span>
            <span class="n">flh</span><span class="o">.</span><span class="n">sm_covariance</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_exp_covariances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.p&#39;</span><span class="p">)</span>
            <span class="n">flh</span><span class="o">.</span><span class="n">exp_covariance</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_exp_covariances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.p&#39;</span><span class="p">)</span>
            <span class="n">flh</span><span class="o">.</span><span class="n">exp_covariance</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">log_likelihood_sm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_sm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_sm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_dict_sm</span><span class="p">,</span> <span class="n">flavio</span><span class="o">.</span><span class="n">WilsonCoefficients</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_sm</span>

    <span class="k">def</span> <span class="nf">_check_sm_cov_loaded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if the SM covariances have been computed or loaded.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sm_cov_loaded</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please load or compute the SM covariances first&quot;</span>
                             <span class="s2">&quot; by calling `make_measurement`.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_ckm_sm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Vus</span><span class="p">,</span> <span class="n">Vcb</span><span class="p">,</span> <span class="n">Vub</span><span class="p">,</span> <span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ckm_scheme</span><span class="o">.</span><span class="n">ckm_np</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Vus&#39;</span><span class="p">:</span> <span class="n">Vus</span><span class="p">,</span> <span class="s1">&#39;Vcb&#39;</span><span class="p">:</span> <span class="n">Vcb</span><span class="p">,</span> <span class="s1">&#39;Vub&#39;</span><span class="p">:</span> <span class="n">Vub</span><span class="p">,</span> <span class="s1">&#39;delta&#39;</span><span class="p">:</span> <span class="n">delta</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">par_dict_sm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the dictionary of parameters where the four CKM parameters</span>
<span class="sd">        `Vus`, `Vcb`, `Vub`, `delta` have been replaced by their</span>
<span class="sd">        &quot;true&quot; values extracted assuming the SM.</span>
<span class="sd">        They should be almost (but not exactly) equal to the default</span>
<span class="sd">        flavio CKM parameters.</span>

<span class="sd">        Note that if `fix_ckm` is set to `True`, this method actually</span>
<span class="sd">        returns the default parameter values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_dict_default</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_par_dict_sm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">par_dict_sm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_dict_default</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">par_dict_sm</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_ckm_sm</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_par_dict_sm</span> <span class="o">=</span> <span class="n">par_dict_sm</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_par_dict_sm</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">obstable_sm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sm_cov_loaded</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_sm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">tree</span><span class="p">()</span>  <span class="c1"># nested dict</span>
            <span class="k">for</span> <span class="n">flh_name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># loop over fast likelihoods: they only have a single &quot;measurement&quot;</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">flh</span><span class="o">.</span><span class="n">pseudo_measurement</span>
                <span class="n">ml</span> <span class="o">=</span> <span class="n">flh</span><span class="o">.</span><span class="n">full_measurement_likelihood</span>
                <span class="n">pred_sm</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">get_predictions_par</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_dict_sm</span><span class="p">,</span>
                                                 <span class="n">flavio</span><span class="o">.</span><span class="n">WilsonCoefficients</span><span class="p">())</span>
                <span class="n">sm_cov</span> <span class="o">=</span> <span class="n">flh</span><span class="o">.</span><span class="n">sm_covariance</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">exp_cov</span> <span class="o">=</span> <span class="n">flh</span><span class="o">.</span><span class="n">exp_covariance</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">inspire_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_inspire_dict</span><span class="p">(</span><span class="n">flh</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span> <span class="n">ml</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">flh</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;lh_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flh_name</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">obs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;th. unc.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sm_cov</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;experiment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_central</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;exp. unc.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">exp_cov</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;exp. PDF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NormalDistribution</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">get_central</span><span class="p">(</span><span class="n">obs</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">exp_cov</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;inspire&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">inspire_dict</span><span class="p">[</span><span class="n">obs</span><span class="p">]))</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;ll_sm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_logprobability_single</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">pred_sm</span><span class="p">[</span><span class="n">obs</span><span class="p">])</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;ll_central&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_logprobability_single</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">get_central</span><span class="p">(</span><span class="n">obs</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">lh_name</span><span class="p">,</span> <span class="n">lh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># loop over &quot;normal&quot; likelihoods</span>
                <span class="n">ml</span> <span class="o">=</span> <span class="n">lh</span><span class="o">.</span><span class="n">measurement_likelihood</span>
                <span class="n">pred_sm</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">get_predictions_par</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_dict_sm</span><span class="p">,</span>
                                                 <span class="n">flavio</span><span class="o">.</span><span class="n">WilsonCoefficients</span><span class="p">())</span>
                <span class="n">inspire_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_inspire_dict</span><span class="p">(</span><span class="n">lh</span><span class="o">.</span><span class="n">observables</span><span class="p">,</span> <span class="n">ml</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lh</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
                    <span class="n">obs_dict</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Observable</span><span class="o">.</span><span class="n">argument_format</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">)</span>
                    <span class="n">obs_name</span> <span class="o">=</span> <span class="n">obs_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
                    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
                        <span class="n">p_comb</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">combine_measurements</span><span class="p">(</span>
                            <span class="n">obs_name</span><span class="p">,</span>
                            <span class="n">include_measurements</span><span class="o">=</span><span class="n">ml</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">obs_dict</span><span class="p">)</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;experiment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_comb</span><span class="o">.</span><span class="n">central_value</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;exp. unc.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">p_comb</span><span class="o">.</span><span class="n">error_left</span><span class="p">,</span> <span class="n">p_comb</span><span class="o">.</span><span class="n">error_right</span><span class="p">)</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;exp. PDF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_comb</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;inspire&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">inspire_dict</span><span class="p">[</span><span class="n">obs</span><span class="p">]))</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;th. unc.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;lh_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lh_name</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">obs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;ll_sm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_comb</span><span class="o">.</span><span class="n">logpdf</span><span class="p">([</span><span class="n">pred_sm</span><span class="p">[</span><span class="n">obs</span><span class="p">]])</span>
                    <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;ll_sm&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
                        <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;ll_sm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1e100</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;ll_central&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_comb</span><span class="o">.</span><span class="n">logpdf</span><span class="p">([</span><span class="n">p_comb</span><span class="o">.</span><span class="n">central_value</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_sm</span> <span class="o">=</span> <span class="n">info</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_sm</span>

    <span class="k">def</span> <span class="nf">get_wilson</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wc_dict</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Wilson</span><span class="p">(</span><span class="n">wc_dict</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">eft</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eft</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the log-likelihood as a dictionary for an instance of</span>
<span class="sd">        `wilson.Wilson`.&quot;&quot;&quot;</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ll</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">flh</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">lh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ll</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">lh</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">clh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ll</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">clh</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span><span class="n">par_dict</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ll</span>

    <span class="nd">@dispatch</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">parameter_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wc_dict</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Choose a point in parameter space by providing a dictionary of</span>
<span class="sd">        Wilson coefficient values (with keys corresponding to WCxf Wilson</span>
<span class="sd">        coefficient names) and the input scale.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">scale</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You need to provide a scale&quot;</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wilson</span><span class="p">(</span><span class="n">wc_dict</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GlobalLikelihoodPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">fix_ckm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">)</span>

    <span class="nd">@dispatch</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">parameter_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wc_dict</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Choose a point in parameter space by providing a dictionary of</span>
<span class="sd">        Wilson coefficient values (with keys corresponding to WCxf Wilson</span>
<span class="sd">        coefficient names) and the input scale.&quot;&quot;&quot;</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wilson</span><span class="p">(</span><span class="n">wc_dict</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GlobalLikelihoodPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">fix_ckm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">)</span>

    <span class="nd">@dispatch</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">parameter_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Choose a point in parameter space by providing the path to a WCxf</span>
<span class="sd">        file.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">wc</span> <span class="o">=</span> <span class="n">wcxf</span><span class="o">.</span><span class="n">WC</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">Wilson</span><span class="o">.</span><span class="n">from_wc</span><span class="p">(</span><span class="n">wc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GlobalLikelihoodPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">fix_ckm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">)</span>

    <span class="nd">@dispatch</span><span class="p">(</span><span class="n">Wilson</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">parameter_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Choose a point in parameter space by providing an instance</span>
<span class="sd">        of `wilson.Wilson`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GlobalLikelihoodPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">fix_ckm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_inspire_dict</span><span class="p">(</span><span class="n">observables</span><span class="p">,</span> <span class="n">ml</span><span class="p">):</span>
        <span class="n">inspire_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">obs_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">observables</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">m_name</span> <span class="ow">in</span> <span class="n">ml</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">:</span>
            <span class="n">m_obj</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="p">[</span><span class="n">m_name</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">obs_set</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">inspire_dict</span><span class="p">:</span>
                    <span class="n">inspire_dict</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">inspire</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">inspire_dict</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">m_obj</span><span class="o">.</span><span class="n">inspire</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">inspire_dict</span>

    <span class="k">def</span> <span class="nf">number_observations_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a dictionary of the number of &quot;observations&quot; for each</span>
<span class="sd">        sublikelihood.</span>

<span class="sd">        Here, an &quot;observation&quot; is defined as an individual measurment</span>
<span class="sd">        of an observable. Thus, the number of observations is always</span>
<span class="sd">        &gt;= the number of observables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nobs_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">nobs_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">flh</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude_observables</span> <span class="ow">or</span> <span class="p">[]))</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">lh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ml</span> <span class="o">=</span>  <span class="n">lh</span><span class="o">.</span><span class="n">measurement_likelihood</span>
            <span class="n">nobs_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">get_number_observations</span><span class="p">(</span>
                <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">clh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">nobs_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">clh</span><span class="o">.</span><span class="n">get_number_observations</span><span class="p">()</span>
        <span class="n">nobs_dict</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">nobs_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;custom_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">nobs_dict</span>

    <span class="k">def</span> <span class="nf">plot_data_2d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">wc_fct</span><span class="p">,</span>
                     <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span>
                     <span class="n">scale</span><span class="p">,</span>
                     <span class="n">steps</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                     <span class="n">threads</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the likelihood on a grid of two non-zero Wilson coefficients.</span>

<span class="sd">        This method is meant for producing contour plots with `flavio.plots`</span>
<span class="sd">        and `matplotlib` in the plane of two Wilson coefficients.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        - `wc_fct`: function of two parameters x and y returning a dictionary</span>
<span class="sd">                    with Wilson coefficients</span>
<span class="sd">        - `x_min`: minimum value of Wilson coefficient on x axis</span>
<span class="sd">        - `x_max`: maximum value of Wilson coefficient on x axis</span>
<span class="sd">        - `y_min`: minimum value of Wilson coefficient on y axis</span>
<span class="sd">        - `y_max`: maximum value of Wilson coefficient on y axis</span>
<span class="sd">        - `scale`: either a function of two parameters x and y returning the</span>
<span class="sd">                   renormalization scale in GeV, or a numerical value fixing the</span>
<span class="sd">                   scale</span>
<span class="sd">        - `steps`: number of steps in each direction. The computing time scales</span>
<span class="sd">                   with the square of this number.</span>
<span class="sd">        - `threads`: number of threads for parallel computation (default: 1)</span>

<span class="sd">        Returns:</span>

<span class="sd">        A dictionary of the  form</span>
<span class="sd">        `{&#39;likelihood_A&#39;: dat_A, &#39;likelihood_B&#39;: dat_B, ...}`</span>
<span class="sd">        where `&#39;likelihood_A&#39;` etc. are the names of the sub- and custom</span>
<span class="sd">        likelihoods (as return by `GlobalLikelihoodPoint.log_likelihood_dict`)</span>
<span class="sd">        and `dat_A` etc. are dictionaries with the keys `x`, `y`, `z`, that</span>
<span class="sd">        can be directly fed to the `flavio.plots.contour` plot function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
        <span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">)</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">steps</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">xy_enumerated</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">xy</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span><span class="n">Number</span><span class="p">):</span>
            <span class="n">scale_fct</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">_scale_fct_fixed</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale_fct</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">_log_likelihood_2d</span><span class="p">,</span> <span class="n">gl</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">wc_fct</span><span class="o">=</span><span class="n">wc_fct</span><span class="p">,</span> <span class="n">scale_fct</span><span class="o">=</span><span class="n">scale_fct</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
        <span class="k">if</span> <span class="n">threads</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pool</span> <span class="o">=</span>  <span class="n">Pool</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span>
            <span class="n">ll_dict_list_enumerated</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="n">xy_enumerated</span><span class="p">)</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ll_dict_list_enumerated</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="n">xy_enumerated</span><span class="p">)</span>
        <span class="n">ll_dict_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ll_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ll_dict</span> <span class="ow">in</span>
            <span class="nb">sorted</span><span class="p">(</span><span class="n">ll_dict_list_enumerated</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="p">]</span>
        <span class="n">plotdata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">ll_dict_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>  <span class="c1"># look at first dict to fix keys</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ll_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">ll_dict</span> <span class="ow">in</span> <span class="n">ll_dict_list</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">steps</span><span class="p">,</span> <span class="n">steps</span><span class="p">))</span>
            <span class="n">plotdata</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="n">z</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">plotdata</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#smelli.classes.GlobalLikelihood">GlobalLikelihood</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="smelli.classes.GlobalLikelihood.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, eft=&#39;SMEFT&#39;, basis=None, par_dict=None, include_likelihoods=None, exclude_likelihoods=None, Nexp=5000, exp_cov_folder=None, sm_cov_folder=None, custom_likelihoods=None, fix_ckm=False, ckm_scheme=&#39;CKMSchemeRmuBtaunuBxlnuDeltaM&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize the likelihood.</p>
<p>Optionally, a dictionary of parameters can be passed as <code>par_dict</code>.
If not given (or not complete), flavio default parameter values will
be used. Note that the CKM elements in <code>par_dict</code> will be ignored as
the "true" CKM elements will be extracted for each parameter point
from the measurement of four input observables:
- <code>'RKpi(P+-&gt;munu)'</code>
- <code>'BR(B+-&gt;taunu)'</code>
- <code>'BR(B-&gt;Xcenu)'</code>
- <code>'DeltaM_d/DeltaM_s'</code></p>
<p>Parameters:</p>
<ul>
<li>eft: a WCxf EFT, must be one of 'SMEFT' (default) or 'WET'.</li>
<li>basis: a WCxf basis, defaults to 'Warsaw' for SMEFT and 'flavio'
  for WET.</li>
<li>include_likelihoods: a list of strings specifying the likelihoods
  to be included (default: all of them). Note that this cannot be used
  to add likelihoods.</li>
<li>exclude_likelihoods: a list of strings specifying the likelihoods
  to be excluded (default: none of them).</li>
<li>Nexp: number of random evaluations of the experimental likelihood
  used to extract the covariance matrix for "fast likelihood"
  instances. Defaults to 5000.</li>
<li>exp_cov_folder: directory containing saved expererimental
  covariances. The data files have to be in the format exported by
  <code>save_exp_covariances</code>.</li>
<li>sm_cov_folder: directory containing saved SM
  covariances. The data files have to be in the format exported by
  <code>save_sm_covariances</code>.</li>
<li>custom_likelihoods: a dictionary in which each value is a list of
  observables and each key is a string that serves as user-defined
  name. For each item of the dictionary, a custom likelihood will be
  computed.</li>
<li>fix_ckm: If False (default), automatically determine the CKM elements
  in the presence of new physics in processes used to determine these
  elements in the SM. If set to True, the CKM elements are fixed to
  their SM values, which can lead to inconsistent results, but also
  to a significant speedup in specific cases.</li>
<li>ckm_scheme: A string with the name of the class defining the CKM
  scheme.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.GlobalLikelihood.__init__', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.GlobalLikelihood.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eft</span><span class="o">=</span><span class="s1">&#39;SMEFT&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">par_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">include_likelihoods</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">exclude_likelihoods</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">Nexp</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
             <span class="n">exp_cov_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">sm_cov_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">custom_likelihoods</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">fix_ckm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">ckm_scheme</span><span class="o">=</span><span class="s1">&#39;CKMSchemeRmuBtaunuBxlnuDeltaM&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize the likelihood.</span>
<span class="sd">    Optionally, a dictionary of parameters can be passed as `par_dict`.</span>
<span class="sd">    If not given (or not complete), flavio default parameter values will</span>
<span class="sd">    be used. Note that the CKM elements in `par_dict` will be ignored as</span>
<span class="sd">    the &quot;true&quot; CKM elements will be extracted for each parameter point</span>
<span class="sd">    from the measurement of four input observables:</span>
<span class="sd">    - `&#39;RKpi(P+-&gt;munu)&#39;`</span>
<span class="sd">    - `&#39;BR(B+-&gt;taunu)&#39;`</span>
<span class="sd">    - `&#39;BR(B-&gt;Xcenu)&#39;`</span>
<span class="sd">    - `&#39;DeltaM_d/DeltaM_s&#39;`</span>
<span class="sd">    Parameters:</span>
<span class="sd">    - eft: a WCxf EFT, must be one of &#39;SMEFT&#39; (default) or &#39;WET&#39;.</span>
<span class="sd">    - basis: a WCxf basis, defaults to &#39;Warsaw&#39; for SMEFT and &#39;flavio&#39;</span>
<span class="sd">      for WET.</span>
<span class="sd">    - include_likelihoods: a list of strings specifying the likelihoods</span>
<span class="sd">      to be included (default: all of them). Note that this cannot be used</span>
<span class="sd">      to add likelihoods.</span>
<span class="sd">    - exclude_likelihoods: a list of strings specifying the likelihoods</span>
<span class="sd">      to be excluded (default: none of them).</span>
<span class="sd">    - Nexp: number of random evaluations of the experimental likelihood</span>
<span class="sd">      used to extract the covariance matrix for &quot;fast likelihood&quot;</span>
<span class="sd">      instances. Defaults to 5000.</span>
<span class="sd">    - exp_cov_folder: directory containing saved expererimental</span>
<span class="sd">      covariances. The data files have to be in the format exported by</span>
<span class="sd">      `save_exp_covariances`.</span>
<span class="sd">    - sm_cov_folder: directory containing saved SM</span>
<span class="sd">      covariances. The data files have to be in the format exported by</span>
<span class="sd">      `save_sm_covariances`.</span>
<span class="sd">    - custom_likelihoods: a dictionary in which each value is a list of</span>
<span class="sd">      observables and each key is a string that serves as user-defined</span>
<span class="sd">      name. For each item of the dictionary, a custom likelihood will be</span>
<span class="sd">      computed.</span>
<span class="sd">    - fix_ckm: If False (default), automatically determine the CKM elements</span>
<span class="sd">      in the presence of new physics in processes used to determine these</span>
<span class="sd">      elements in the SM. If set to True, the CKM elements are fixed to</span>
<span class="sd">      their SM values, which can lead to inconsistent results, but also</span>
<span class="sd">      to a significant speedup in specific cases.</span>
<span class="sd">    - ckm_scheme: A string with the name of the class defining the CKM</span>
<span class="sd">      scheme.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eft</span> <span class="o">=</span> <span class="n">eft</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">basis</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_bases</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eft</span><span class="p">]</span>
    <span class="n">par_dict</span> <span class="o">=</span> <span class="n">par_dict</span> <span class="ow">or</span> <span class="p">{}</span>  <span class="c1"># initialize empty if not given</span>
    <span class="c1"># take missing parameters from flavio defaults</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">par_dict_default</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">default_parameters</span><span class="o">.</span><span class="n">get_central_all</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">par_dict_default</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">par_dict</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_par_dict_sm</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span> <span class="o">=</span> <span class="n">fix_ckm</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fast_likelihoods_yaml</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fast_likelihoods_yaml_fixckm</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ckm_scheme</span> <span class="o">=</span> <span class="n">get_ckm_schemes</span><span class="p">()[</span><span class="n">ckm_scheme</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ckm_scheme_name</span> <span class="o">=</span> <span class="n">ckm_scheme</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CKM scheme &#39;</span><span class="si">{}</span><span class="s2">&#39; is not defined.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ckm_scheme</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">likelihoods</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_custom_likelihoods_dict</span> <span class="o">=</span> <span class="n">custom_likelihoods</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">custom_likelihoods</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_load_likelihoods</span><span class="p">(</span><span class="n">include_likelihoods</span><span class="o">=</span><span class="n">include_likelihoods</span><span class="p">,</span>
                           <span class="n">exclude_likelihoods</span><span class="o">=</span><span class="n">exclude_likelihoods</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_Nexp</span> <span class="o">=</span> <span class="n">Nexp</span>
    <span class="k">if</span> <span class="n">exp_cov_folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_exp_covariances</span><span class="p">(</span><span class="n">exp_cov_folder</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sm_cov_loaded</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sm_cov_folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_sm_covariances</span><span class="p">(</span><span class="n">get_datapath</span><span class="p">(</span><span class="s1">&#39;smelli&#39;</span><span class="p">,</span> <span class="s1">&#39;data/cache&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_sm_covariances</span><span class="p">(</span><span class="n">sm_cov_folder</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sm_cov_loaded</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_measurement</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">):</span>
        <span class="k">raise</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;There was a problem loading the SM covariances. &quot;</span>
                      <span class="s2">&quot;Please recompute them with `make_measurement`.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_sm</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_sm</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smelli.classes.GlobalLikelihood.get_ckm_sm">
    <p>def <span class="ident">get_ckm_sm</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.GlobalLikelihood.get_ckm_sm', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.GlobalLikelihood.get_ckm_sm" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_ckm_sm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">Vus</span><span class="p">,</span> <span class="n">Vcb</span><span class="p">,</span> <span class="n">Vub</span><span class="p">,</span> <span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ckm_scheme</span><span class="o">.</span><span class="n">ckm_np</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Vus&#39;</span><span class="p">:</span> <span class="n">Vus</span><span class="p">,</span> <span class="s1">&#39;Vcb&#39;</span><span class="p">:</span> <span class="n">Vcb</span><span class="p">,</span> <span class="s1">&#39;Vub&#39;</span><span class="p">:</span> <span class="n">Vub</span><span class="p">,</span> <span class="s1">&#39;delta&#39;</span><span class="p">:</span> <span class="n">delta</span><span class="p">}</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smelli.classes.GlobalLikelihood.get_wilson">
    <p>def <span class="ident">get_wilson</span>(</p><p>self, wc_dict, scale)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.GlobalLikelihood.get_wilson', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.GlobalLikelihood.get_wilson" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_wilson</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wc_dict</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Wilson</span><span class="p">(</span><span class="n">wc_dict</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">eft</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eft</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smelli.classes.GlobalLikelihood.load_exp_covariances">
    <p>def <span class="ident">load_exp_covariances</span>(</p><p>self, folder)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.GlobalLikelihood.load_exp_covariances', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.GlobalLikelihood.load_exp_covariances" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load_exp_covariances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.p&#39;</span><span class="p">)</span>
        <span class="n">flh</span><span class="o">.</span><span class="n">exp_covariance</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smelli.classes.GlobalLikelihood.load_sm_covariances">
    <p>def <span class="ident">load_sm_covariances</span>(</p><p>self, folder)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.GlobalLikelihood.load_sm_covariances', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.GlobalLikelihood.load_sm_covariances" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load_sm_covariances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_fix_ckm&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ckm_scheme_name</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.p&#39;</span><span class="p">)</span>
        <span class="n">flh</span><span class="o">.</span><span class="n">sm_covariance</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smelli.classes.GlobalLikelihood.make_measurement">
    <p>def <span class="ident">make_measurement</span>(</p><p>self, *args, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize the likelihood by producing a pseudo-measurement containing both
experimental uncertainties as well as theory uncertainties stemming
from nuisance parameters.</p>
<p>Optional parameters:</p>
<ul>
<li><code>N</code>: number of random computations for the SM covariance (computing
  time is proportional to it; more means less random fluctuations.)</li>
<li><code>Nexp</code>: number of random computations for the experimental covariance.
  This is much less expensive than the theory covariance, so a large
  number can be afforded (default: 5000).</li>
<li><code>threads</code>: number of parallel threads for the SM
  covariance computation. Defaults to 1 (no parallelization).</li>
<li><code>force</code>: if True, will recompute SM covariance even if it
  already has been computed. Defaults to False.</li>
<li><code>force_exp</code>: if True, will recompute experimental central values and
  covariance even if they have already been computed. Defaults to False.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.GlobalLikelihood.make_measurement', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.GlobalLikelihood.make_measurement" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">make_measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize the likelihood by producing a pseudo-measurement containing both</span>
<span class="sd">    experimental uncertainties as well as theory uncertainties stemming</span>
<span class="sd">    from nuisance parameters.</span>
<span class="sd">    Optional parameters:</span>
<span class="sd">    - `N`: number of random computations for the SM covariance (computing</span>
<span class="sd">      time is proportional to it; more means less random fluctuations.)</span>
<span class="sd">    - `Nexp`: number of random computations for the experimental covariance.</span>
<span class="sd">      This is much less expensive than the theory covariance, so a large</span>
<span class="sd">      number can be afforded (default: 5000).</span>
<span class="sd">    - `threads`: number of parallel threads for the SM</span>
<span class="sd">      covariance computation. Defaults to 1 (no parallelization).</span>
<span class="sd">    - `force`: if True, will recompute SM covariance even if it</span>
<span class="sd">      already has been computed. Defaults to False.</span>
<span class="sd">    - `force_exp`: if True, will recompute experimental central values and</span>
<span class="sd">      covariance even if they have already been computed. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;Nexp&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Nexp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Nexp</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">flh</span><span class="o">.</span><span class="n">make_measurement</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sm_cov_loaded</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smelli.classes.GlobalLikelihood.number_observations_dict">
    <p>def <span class="ident">number_observations_dict</span>(</p><p>self, exclude_observables=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Get a dictionary of the number of "observations" for each
sublikelihood.</p>
<p>Here, an "observation" is defined as an individual measurment
of an observable. Thus, the number of observations is always</p>
<blockquote>
<p>= the number of observables.</p>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.GlobalLikelihood.number_observations_dict', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.GlobalLikelihood.number_observations_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">number_observations_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclude_observables</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a dictionary of the number of &quot;observations&quot; for each</span>
<span class="sd">    sublikelihood.</span>
<span class="sd">    Here, an &quot;observation&quot; is defined as an individual measurment</span>
<span class="sd">    of an observable. Thus, the number of observations is always</span>
<span class="sd">    &gt;= the number of observables.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nobs_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">nobs_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">flh</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude_observables</span> <span class="ow">or</span> <span class="p">[]))</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">lh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">ml</span> <span class="o">=</span>  <span class="n">lh</span><span class="o">.</span><span class="n">measurement_likelihood</span>
        <span class="n">nobs_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">get_number_observations</span><span class="p">(</span>
            <span class="n">exclude_observables</span><span class="o">=</span><span class="n">exclude_observables</span>
        <span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">clh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">nobs_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">clh</span><span class="o">.</span><span class="n">get_number_observations</span><span class="p">()</span>
    <span class="n">nobs_dict</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">nobs_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;custom_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">nobs_dict</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smelli.classes.GlobalLikelihood.plot_data_2d">
    <p>def <span class="ident">plot_data_2d</span>(</p><p>self, wc_fct, x_min, x_max, y_min, y_max, scale, steps=20, threads=1)</p>
    </div>
    

    
  
    <div class="desc"><p>Compute the likelihood on a grid of two non-zero Wilson coefficients.</p>
<p>This method is meant for producing contour plots with <code>flavio.plots</code>
and <code>matplotlib</code> in the plane of two Wilson coefficients.</p>
<p>Parameters:</p>
<ul>
<li><code>wc_fct</code>: function of two parameters x and y returning a dictionary
            with Wilson coefficients</li>
<li><code>x_min</code>: minimum value of Wilson coefficient on x axis</li>
<li><code>x_max</code>: maximum value of Wilson coefficient on x axis</li>
<li><code>y_min</code>: minimum value of Wilson coefficient on y axis</li>
<li><code>y_max</code>: maximum value of Wilson coefficient on y axis</li>
<li><code>scale</code>: either a function of two parameters x and y returning the
           renormalization scale in GeV, or a numerical value fixing the
           scale</li>
<li><code>steps</code>: number of steps in each direction. The computing time scales
           with the square of this number.</li>
<li><code>threads</code>: number of threads for parallel computation (default: 1)</li>
</ul>
<p>Returns:</p>
<p>A dictionary of the  form
<code>{'likelihood_A': dat_A, 'likelihood_B': dat_B, ...}</code>
where <code>'likelihood_A'</code> etc. are the names of the sub- and custom
likelihoods (as return by <code>GlobalLikelihoodPoint.log_likelihood_dict</code>)
and <code>dat_A</code> etc. are dictionaries with the keys <code>x</code>, <code>y</code>, <code>z</code>, that
can be directly fed to the <code>flavio.plots.contour</code> plot function.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.GlobalLikelihood.plot_data_2d', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.GlobalLikelihood.plot_data_2d" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_data_2d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">wc_fct</span><span class="p">,</span>
                 <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span>
                 <span class="n">scale</span><span class="p">,</span>
                 <span class="n">steps</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                 <span class="n">threads</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the likelihood on a grid of two non-zero Wilson coefficients.</span>
<span class="sd">    This method is meant for producing contour plots with `flavio.plots`</span>
<span class="sd">    and `matplotlib` in the plane of two Wilson coefficients.</span>
<span class="sd">    Parameters:</span>
<span class="sd">    - `wc_fct`: function of two parameters x and y returning a dictionary</span>
<span class="sd">                with Wilson coefficients</span>
<span class="sd">    - `x_min`: minimum value of Wilson coefficient on x axis</span>
<span class="sd">    - `x_max`: maximum value of Wilson coefficient on x axis</span>
<span class="sd">    - `y_min`: minimum value of Wilson coefficient on y axis</span>
<span class="sd">    - `y_max`: maximum value of Wilson coefficient on y axis</span>
<span class="sd">    - `scale`: either a function of two parameters x and y returning the</span>
<span class="sd">               renormalization scale in GeV, or a numerical value fixing the</span>
<span class="sd">               scale</span>
<span class="sd">    - `steps`: number of steps in each direction. The computing time scales</span>
<span class="sd">               with the square of this number.</span>
<span class="sd">    - `threads`: number of threads for parallel computation (default: 1)</span>
<span class="sd">    Returns:</span>
<span class="sd">    A dictionary of the  form</span>
<span class="sd">    `{&#39;likelihood_A&#39;: dat_A, &#39;likelihood_B&#39;: dat_B, ...}`</span>
<span class="sd">    where `&#39;likelihood_A&#39;` etc. are the names of the sub- and custom</span>
<span class="sd">    likelihoods (as return by `GlobalLikelihoodPoint.log_likelihood_dict`)</span>
<span class="sd">    and `dat_A` etc. are dictionaries with the keys `x`, `y`, `z`, that</span>
<span class="sd">    can be directly fed to the `flavio.plots.contour` plot function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
    <span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">)</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">steps</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">xy_enumerated</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">xy</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span><span class="n">Number</span><span class="p">):</span>
        <span class="n">scale_fct</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">_scale_fct_fixed</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scale_fct</span> <span class="o">=</span> <span class="n">scale</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">_log_likelihood_2d</span><span class="p">,</span> <span class="n">gl</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">wc_fct</span><span class="o">=</span><span class="n">wc_fct</span><span class="p">,</span> <span class="n">scale_fct</span><span class="o">=</span><span class="n">scale_fct</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
    <span class="k">if</span> <span class="n">threads</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">pool</span> <span class="o">=</span>  <span class="n">Pool</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span>
        <span class="n">ll_dict_list_enumerated</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="n">xy_enumerated</span><span class="p">)</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ll_dict_list_enumerated</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="n">xy_enumerated</span><span class="p">)</span>
    <span class="n">ll_dict_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">ll_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ll_dict</span> <span class="ow">in</span>
        <span class="nb">sorted</span><span class="p">(</span><span class="n">ll_dict_list_enumerated</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="p">]</span>
    <span class="n">plotdata</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="n">ll_dict_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>  <span class="c1"># look at first dict to fix keys</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ll_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">ll_dict</span> <span class="ow">in</span> <span class="n">ll_dict_list</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">steps</span><span class="p">,</span> <span class="n">steps</span><span class="p">))</span>
        <span class="n">plotdata</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="n">z</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">plotdata</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smelli.classes.GlobalLikelihood.save_exp_covariances">
    <p>def <span class="ident">save_exp_covariances</span>(</p><p>self, folder)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.GlobalLikelihood.save_exp_covariances', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.GlobalLikelihood.save_exp_covariances" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_exp_covariances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.p&#39;</span><span class="p">)</span>
        <span class="n">flh</span><span class="o">.</span><span class="n">exp_covariance</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smelli.classes.GlobalLikelihood.save_sm_covariances">
    <p>def <span class="ident">save_sm_covariances</span>(</p><p>self, folder)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.GlobalLikelihood.save_sm_covariances', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.GlobalLikelihood.save_sm_covariances" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_sm_covariances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_fix_ckm&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ckm_scheme_name</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.p&#39;</span><span class="p">)</span>
        <span class="n">flh</span><span class="o">.</span><span class="n">sm_covariance</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="smelli.classes.GlobalLikelihood.basis" class="name">var <span class="ident">basis</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smelli.classes.GlobalLikelihood.custom_likelihoods" class="name">var <span class="ident">custom_likelihoods</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smelli.classes.GlobalLikelihood.eft" class="name">var <span class="ident">eft</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smelli.classes.GlobalLikelihood.fast_likelihoods" class="name">var <span class="ident">fast_likelihoods</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smelli.classes.GlobalLikelihood.fix_ckm" class="name">var <span class="ident">fix_ckm</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smelli.classes.GlobalLikelihood.likelihoods" class="name">var <span class="ident">likelihoods</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smelli.classes.GlobalLikelihood.log_likelihood_sm" class="name">var <span class="ident">log_likelihood_sm</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smelli.classes.GlobalLikelihood.obstable_sm" class="name">var <span class="ident">obstable_sm</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smelli.classes.GlobalLikelihood.par_dict_default" class="name">var <span class="ident">par_dict_default</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smelli.classes.GlobalLikelihood.par_dict_sm" class="name">var <span class="ident">par_dict_sm</span></p>
            

            
  
    <div class="desc"><p>Return the dictionary of parameters where the four CKM parameters
<code>Vus</code>, <code>Vcb</code>, <code>Vub</code>, <code>delta</code> have been replaced by their
"true" values extracted assuming the SM.
They should be almost (but not exactly) equal to the default
flavio CKM parameters.</p>
<p>Note that if <code>fix_ckm</code> is set to <code>True</code>, this method actually
returns the default parameter values.</p></div>
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="smelli.classes.GlobalLikelihoodPoint" class="name">class <span class="ident">GlobalLikelihoodPoint</span></p>
      
  
    <div class="desc"><p>Class representing the properties of the likelihood function at a
specific point in parameter space.</p>
<p>Attributes:</p>
<ul>
<li><code>log_likelihood_dict</code>: dictionary with individual contributions
to the log-likelihood</li>
<li><code>value</code>: Return the numerical values of the global log-likelihood
compared to the SM value (can also be acessed with <code>float(self)</code>)</li>
</ul>
<p>Methods:</p>
<ul>
<li><code>get_obstable</code>: return a pandas data frame with the values and pulls
for each individual observable, given the Wilson coefficients</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.GlobalLikelihoodPoint', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.GlobalLikelihoodPoint" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">GlobalLikelihoodPoint</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class representing the properties of the likelihood function at a</span>
<span class="sd">    specific point in parameter space.</span>

<span class="sd">    Attributes:</span>

<span class="sd">    - `log_likelihood_dict`: dictionary with individual contributions</span>
<span class="sd">    to the log-likelihood</span>
<span class="sd">    - `value`: Return the numerical values of the global log-likelihood</span>
<span class="sd">    compared to the SM value (can also be acessed with `float(self)`)</span>

<span class="sd">    Methods:</span>

<span class="sd">    - `get_obstable`: return a pandas data frame with the values and pulls</span>
<span class="sd">    for each individual observable, given the Wilson coefficients</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span>
                 <span class="n">fix_ckm</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the `GlobalLikelihoodPoint` instance.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - likelihood: an instance of `GlobalLikelihood`</span>
<span class="sd">        - w: an instance of `wilson.Wilson`</span>
<span class="sd">        - fix_ckm: If False (default), automatically determine the CKM elements</span>
<span class="sd">          in the presence of new physics in processes used to determine these</span>
<span class="sd">          elements in the SM. If set to True, the CKM elements are fixed to</span>
<span class="sd">          their SM values, which can lead to inconsistent results, but also</span>
<span class="sd">          to a significant speedup in specific cases.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span> <span class="o">=</span> <span class="n">likelihood</span>
        <span class="n">likelihood</span><span class="o">.</span><span class="n">_check_sm_cov_loaded</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w_input</span> <span class="o">=</span> <span class="n">w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span> <span class="o">=</span> <span class="n">fix_ckm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_w</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_tree_cache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_par_dict_np</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">w</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_input</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;parameters&#39;</span><span class="p">)</span>
            <span class="n">par</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_dict_np</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Vus&#39;</span><span class="p">,</span> <span class="s1">&#39;Vcb&#39;</span><span class="p">,</span> <span class="s1">&#39;Vub&#39;</span><span class="p">,</span> <span class="s1">&#39;delta&#39;</span><span class="p">]:</span>
                <span class="n">opt</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
            <span class="n">w</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;parameters&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_w</span> <span class="o">=</span> <span class="n">w</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_w</span>

    <span class="k">def</span> <span class="nf">get_ckm_np</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return the values of the four &quot;true&quot; CKM parameters</span>
<span class="sd">        `Vus`, `Vcb`, `Vub`, `delta`, extracted from the four input observables</span>
<span class="sd">        for this parameter point in Wilson coefficient space.&quot;&quot;&quot;</span>
        <span class="n">scheme</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">_ckm_scheme</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Vus</span><span class="p">,</span> <span class="n">Vcb</span><span class="p">,</span> <span class="n">Vub</span><span class="p">,</span> <span class="n">delta</span> <span class="o">=</span> <span class="n">scheme</span><span class="o">.</span><span class="n">ckm_np</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_input</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># this happens mostly when the formulas result in |cos(delta)| &gt; 1</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The extraction of CKM elements failed. Too large NP effects?&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Vus&#39;</span><span class="p">:</span> <span class="n">Vus</span><span class="p">,</span> <span class="s1">&#39;Vcb&#39;</span><span class="p">:</span> <span class="n">Vcb</span><span class="p">,</span> <span class="s1">&#39;Vub&#39;</span><span class="p">:</span> <span class="n">Vub</span><span class="p">,</span> <span class="s1">&#39;delta&#39;</span><span class="p">:</span> <span class="n">delta</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">par_dict_np</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the dictionary of parameters where the four CKM parameters</span>
<span class="sd">        `Vus`, `Vcb`, `Vub`, `delta` have been replaced by their</span>
<span class="sd">        &quot;true&quot; values as extracted from the four input observables.</span>

<span class="sd">        Note that if `fix_ckm` is set to `True`, this method actually</span>
<span class="sd">        returns the SM values.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">par_dict_sm</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_par_dict_np</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">par_dict_np</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">par_dict_default</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">par_dict_np</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_ckm_np</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_par_dict_np</span> <span class="o">=</span> <span class="n">par_dict_np</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_par_dict_np</span>

    <span class="k">def</span> <span class="nf">_delta_log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the delta log likelihood for the individual likelihoods&quot;&quot;&quot;</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">_log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_dict_np</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
            <span class="n">ll</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">log_likelihood_sm</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">ll</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ll</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;custom_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">ll</span>

    <span class="k">def</span> <span class="nf">log_likelihood_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a dictionary with the delta log likelihood values</span>
<span class="sd">        for the individual contributions.</span>

<span class="sd">        Cached after the first call.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta_log_likelihood</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_dict</span>

    <span class="k">def</span> <span class="nf">log_likelihood_global</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the value of the global delta log likelihood.</span>

<span class="sd">        Cached after the first call. Corresponds to the `global` key of</span>
<span class="sd">        the dictionary returned by `log_likelihood_dict`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_dict</span><span class="p">()[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">pvalue_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_par</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Dictionary of $p$ values of sublikelihoods given the number `n_par`</span>
<span class="sd">        of free parameters (default 0).&quot;&quot;&quot;</span>
        <span class="n">nobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">number_observations_dict</span><span class="p">()</span>
        <span class="n">chi2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chi2_dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">pvalue</span><span class="p">(</span><span class="n">chi2</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">dof</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nobs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">n_par</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">chi2</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">chi2_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Dictionary of total $\chi^2$ values of each sublikelihood.</span>

<span class="sd">        $$\chi^2 = -2 (\ln L + \ln L_\text{SM})$$</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_dict</span><span class="p">()</span>
        <span class="n">llsm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">_log_likelihood_sm</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">llsm</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">llsm</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;custom_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ll</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">llsm</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_obstable_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_tree_cache</span><span class="p">:</span>
            <span class="n">llh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">llh</span><span class="o">.</span><span class="n">obstable_sm</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">flh_name</span><span class="p">,</span> <span class="n">flh</span> <span class="ow">in</span> <span class="n">llh</span><span class="o">.</span><span class="n">fast_likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># loop over fast likelihoods: they only have a single &quot;measurement&quot;</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">flh</span><span class="o">.</span><span class="n">pseudo_measurement</span>
                <span class="n">ml</span> <span class="o">=</span> <span class="n">flh</span><span class="o">.</span><span class="n">full_measurement_likelihood</span>
                <span class="n">pred</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">get_predictions_par</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_dict_np</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">flh</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;theory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span>
                    <span class="n">ll_central</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;ll_central&#39;</span><span class="p">]</span>
                    <span class="n">ll_sm</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;ll_sm&#39;</span><span class="p">]</span>
                    <span class="n">ll</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_logprobability_single</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">pred</span><span class="p">[</span><span class="n">obs</span><span class="p">])</span>
                    <span class="c1"># DeltaChi2 is -2*DeltaLogLikelihood</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;pull exp.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pull</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ll</span> <span class="o">-</span> <span class="n">ll_central</span><span class="p">),</span> <span class="n">dof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">ll</span> <span class="o">&gt;</span> <span class="n">ll_sm</span> <span class="k">else</span> <span class="mi">1</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;pull SM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">pull</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ll</span> <span class="o">-</span> <span class="n">ll_sm</span><span class="p">),</span> <span class="n">dof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">lh_name</span><span class="p">,</span> <span class="n">lh</span> <span class="ow">in</span> <span class="n">llh</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># loop over &quot;normal&quot; likelihoods</span>
                <span class="n">ml</span> <span class="o">=</span> <span class="n">lh</span><span class="o">.</span><span class="n">measurement_likelihood</span>
                <span class="n">pred</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">get_predictions_par</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par_dict_np</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lh</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;theory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span>
                    <span class="n">ll_central</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;ll_central&#39;</span><span class="p">]</span>
                    <span class="n">ll_sm</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;ll_sm&#39;</span><span class="p">]</span>
                    <span class="n">p_comb</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;exp. PDF&#39;</span><span class="p">]</span>
                    <span class="n">ll</span> <span class="o">=</span> <span class="n">p_comb</span><span class="o">.</span><span class="n">logpdf</span><span class="p">([</span><span class="n">pred</span><span class="p">[</span><span class="n">obs</span><span class="p">]])</span>
                    <span class="k">if</span> <span class="n">ll</span> <span class="o">==</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
                        <span class="n">ll</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1e100</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;pull exp.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pull</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ll</span> <span class="o">-</span> <span class="n">ll_central</span><span class="p">),</span> <span class="n">dof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">ll</span> <span class="o">&gt;</span> <span class="n">ll_sm</span> <span class="k">else</span> <span class="mi">1</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">obs</span><span class="p">][</span><span class="s1">&#39;pull SM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">pull</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ll</span> <span class="o">-</span> <span class="n">ll_sm</span><span class="p">),</span> <span class="n">dof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_tree_cache</span> <span class="o">=</span> <span class="n">info</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_tree_cache</span>

    <span class="k">def</span> <span class="nf">obstable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_pull_exp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s1">&#39;pull exp.&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">min_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return a pandas data frame with the central values and uncertainties</span>
<span class="sd">        as well as the pulls with respect to the experimental and the SM values for each observable.</span>

<span class="sd">        The pull is defined is $\sqrt(|-2\ln L|)$. Note that the global</span>
<span class="sd">        likelihood is *not* simply proportional to the sum of squared pulls</span>
<span class="sd">        due to correlations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sort_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;exp. unc.&#39;</span><span class="p">,</span> <span class="s1">&#39;experiment&#39;</span><span class="p">,</span> <span class="s1">&#39;pull SM&#39;</span><span class="p">,</span> <span class="s1">&#39;pull exp.&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;th. unc.&#39;</span><span class="p">,</span> <span class="s1">&#39;theory&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">sort_by</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sort_keys</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; is not an allowed value for sort_by. Allowed values are &quot;</span>
                <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39;, and &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sort_by</span><span class="p">,</span> <span class="s2">&quot;&#39;, &#39;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sort_keys</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                                         <span class="n">sort_keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_tree</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">sort_by</span> <span class="o">==</span> <span class="s1">&#39;pull exp.&#39;</span><span class="p">:</span>
            <span class="c1"># if sorted by pull exp., use descending order as default</span>
            <span class="k">if</span> <span class="n">ascending</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">min_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">min_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_pull_exp</span><span class="p">,</span> <span class="n">min_val</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">min_val</span> <span class="o">=</span> <span class="n">min_pull_exp</span>
        <span class="k">elif</span> <span class="n">min_pull_exp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">subset</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;pull exp.&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_pull_exp</span>
        <span class="c1"># if sorted not by pull exp., use ascending order as default</span>
        <span class="k">if</span> <span class="n">ascending</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ascending</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_filter_sort</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">sortkey</span><span class="o">=</span><span class="n">sort_by</span><span class="p">,</span>
                                          <span class="n">ascending</span><span class="o">=</span><span class="n">ascending</span><span class="p">,</span>
                                          <span class="n">min_val</span><span class="o">=</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="n">max_val</span><span class="p">,</span>
                                          <span class="n">subset</span><span class="o">=</span><span class="n">subset</span><span class="p">)</span>
        <span class="c1"># create DataFrame</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">info</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># if df has length 0 (e.g. if min_pull is very large) there are no</span>
        <span class="c1"># columns that could be removed</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="c1"># remove columns that are only used internal and should not be</span>
            <span class="c1"># included in obstable</span>
            <span class="k">del</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;inspire&#39;</span><span class="p">])</span>
            <span class="k">del</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;lh_name&#39;</span><span class="p">])</span>
            <span class="k">del</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="k">del</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;exp. PDF&#39;</span><span class="p">])</span>
            <span class="k">del</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ll_central&#39;</span><span class="p">])</span>
            <span class="k">del</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ll_sm&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_obstable_filter_sort</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">sortkey</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">min_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">subset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_rows</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># impose min_val and max_val</span>
        <span class="k">if</span> <span class="n">min_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="n">obs</span><span class="p">:</span><span class="n">row</span> <span class="k">for</span> <span class="n">obs</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="n">sortkey</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_val</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">max_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="n">obs</span><span class="p">:</span><span class="n">row</span> <span class="k">for</span> <span class="n">obs</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="n">sortkey</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">max_val</span><span class="p">}</span>
        <span class="c1"># get only subset:</span>
        <span class="k">if</span> <span class="n">subset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="n">obs</span><span class="p">:</span><span class="n">row</span> <span class="k">for</span> <span class="n">obs</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">subset</span><span class="p">(</span><span class="n">row</span><span class="p">)}</span>
        <span class="c1"># sort</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">sortkey</span><span class="p">],</span>
                                  <span class="n">reverse</span><span class="o">=</span><span class="p">(</span><span class="ow">not</span> <span class="n">ascending</span><span class="p">)))</span>
        <span class="c1"># restrict number of rows per tabular to max_rows</span>
        <span class="k">if</span> <span class="n">max_rows</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">max_rows</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">info</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">info_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span><span class="o">/</span><span class="n">max_rows</span><span class="p">)):</span>
                <span class="n">info_n</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">obs</span><span class="p">,</span><span class="n">row</span><span class="p">)</span>
                                    <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">obs</span><span class="p">,</span><span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                                    <span class="k">if</span> <span class="n">i</span><span class="o">&gt;=</span><span class="n">n</span><span class="o">*</span><span class="n">max_rows</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">max_rows</span><span class="p">)</span>
                <span class="n">info_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info_n</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">info_list</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#smelli.classes.GlobalLikelihoodPoint">GlobalLikelihoodPoint</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="smelli.classes.GlobalLikelihoodPoint.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, likelihood, w, fix_ckm=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize the <code>GlobalLikelihoodPoint</code> instance.</p>
<p>Parameters:
- likelihood: an instance of <code>GlobalLikelihood</code>
- w: an instance of <code>wilson.Wilson</code>
- fix_ckm: If False (default), automatically determine the CKM elements
  in the presence of new physics in processes used to determine these
  elements in the SM. If set to True, the CKM elements are fixed to
  their SM values, which can lead to inconsistent results, but also
  to a significant speedup in specific cases.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.GlobalLikelihoodPoint.__init__', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.GlobalLikelihoodPoint.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span>
             <span class="n">fix_ckm</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize the `GlobalLikelihoodPoint` instance.</span>
<span class="sd">    Parameters:</span>
<span class="sd">    - likelihood: an instance of `GlobalLikelihood`</span>
<span class="sd">    - w: an instance of `wilson.Wilson`</span>
<span class="sd">    - fix_ckm: If False (default), automatically determine the CKM elements</span>
<span class="sd">      in the presence of new physics in processes used to determine these</span>
<span class="sd">      elements in the SM. If set to True, the CKM elements are fixed to</span>
<span class="sd">      their SM values, which can lead to inconsistent results, but also</span>
<span class="sd">      to a significant speedup in specific cases.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span> <span class="o">=</span> <span class="n">likelihood</span>
    <span class="n">likelihood</span><span class="o">.</span><span class="n">_check_sm_cov_loaded</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">w_input</span> <span class="o">=</span> <span class="n">w</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fix_ckm</span> <span class="o">=</span> <span class="n">fix_ckm</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_w</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_tree_cache</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_par_dict_np</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smelli.classes.GlobalLikelihoodPoint.chi2_dict">
    <p>def <span class="ident">chi2_dict</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Dictionary of total $\chi^2$ values of each sublikelihood.</p>
<p>$$\chi^2 = -2 (\ln L + \ln L_\text{SM})$$</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.GlobalLikelihoodPoint.chi2_dict', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.GlobalLikelihoodPoint.chi2_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">chi2_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Dictionary of total $\chi^2$ values of each sublikelihood.</span>
<span class="sd">    $$\chi^2 = -2 (\ln L + \ln L_\text{SM})$$</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_dict</span><span class="p">()</span>
    <span class="n">llsm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">_log_likelihood_sm</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">llsm</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">llsm</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;custom_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ll</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">llsm</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">}</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smelli.classes.GlobalLikelihoodPoint.get_ckm_np">
    <p>def <span class="ident">get_ckm_np</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>return the values of the four "true" CKM parameters
<code>Vus</code>, <code>Vcb</code>, <code>Vub</code>, <code>delta</code>, extracted from the four input observables
for this parameter point in Wilson coefficient space.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.GlobalLikelihoodPoint.get_ckm_np', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.GlobalLikelihoodPoint.get_ckm_np" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_ckm_np</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;return the values of the four &quot;true&quot; CKM parameters</span>
<span class="sd">    `Vus`, `Vcb`, `Vub`, `delta`, extracted from the four input observables</span>
<span class="sd">    for this parameter point in Wilson coefficient space.&quot;&quot;&quot;</span>
    <span class="n">scheme</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">_ckm_scheme</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">Vus</span><span class="p">,</span> <span class="n">Vcb</span><span class="p">,</span> <span class="n">Vub</span><span class="p">,</span> <span class="n">delta</span> <span class="o">=</span> <span class="n">scheme</span><span class="o">.</span><span class="n">ckm_np</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_input</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="c1"># this happens mostly when the formulas result in |cos(delta)| &gt; 1</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The extraction of CKM elements failed. Too large NP effects?&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Vus&#39;</span><span class="p">:</span> <span class="n">Vus</span><span class="p">,</span> <span class="s1">&#39;Vcb&#39;</span><span class="p">:</span> <span class="n">Vcb</span><span class="p">,</span> <span class="s1">&#39;Vub&#39;</span><span class="p">:</span> <span class="n">Vub</span><span class="p">,</span> <span class="s1">&#39;delta&#39;</span><span class="p">:</span> <span class="n">delta</span><span class="p">}</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smelli.classes.GlobalLikelihoodPoint.log_likelihood_dict">
    <p>def <span class="ident">log_likelihood_dict</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Return a dictionary with the delta log likelihood values
for the individual contributions.</p>
<p>Cached after the first call.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.GlobalLikelihoodPoint.log_likelihood_dict', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.GlobalLikelihoodPoint.log_likelihood_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_likelihood_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a dictionary with the delta log likelihood values</span>
<span class="sd">    for the individual contributions.</span>
<span class="sd">    Cached after the first call.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta_log_likelihood</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood_dict</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smelli.classes.GlobalLikelihoodPoint.log_likelihood_global">
    <p>def <span class="ident">log_likelihood_global</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the value of the global delta log likelihood.</p>
<p>Cached after the first call. Corresponds to the <code>global</code> key of
the dictionary returned by <code>log_likelihood_dict</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.GlobalLikelihoodPoint.log_likelihood_global', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.GlobalLikelihoodPoint.log_likelihood_global" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_likelihood_global</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the value of the global delta log likelihood.</span>
<span class="sd">    Cached after the first call. Corresponds to the `global` key of</span>
<span class="sd">    the dictionary returned by `log_likelihood_dict`.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood_dict</span><span class="p">()[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smelli.classes.GlobalLikelihoodPoint.obstable">
    <p>def <span class="ident">obstable</span>(</p><p>self, min_pull_exp=0, sort_by=&#39;pull exp.&#39;, ascending=None, min_val=None, max_val=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Return a pandas data frame with the central values and uncertainties
as well as the pulls with respect to the experimental and the SM values for each observable.</p>
<p>The pull is defined is $\sqrt(|-2\ln L|)$. Note that the global
likelihood is <em>not</em> simply proportional to the sum of squared pulls
due to correlations.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.GlobalLikelihoodPoint.obstable', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.GlobalLikelihoodPoint.obstable" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">obstable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_pull_exp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s1">&#39;pull exp.&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">min_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return a pandas data frame with the central values and uncertainties</span>
<span class="sd">    as well as the pulls with respect to the experimental and the SM values for each observable.</span>
<span class="sd">    The pull is defined is $\sqrt(|-2\ln L|)$. Note that the global</span>
<span class="sd">    likelihood is *not* simply proportional to the sum of squared pulls</span>
<span class="sd">    due to correlations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sort_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;exp. unc.&#39;</span><span class="p">,</span> <span class="s1">&#39;experiment&#39;</span><span class="p">,</span> <span class="s1">&#39;pull SM&#39;</span><span class="p">,</span> <span class="s1">&#39;pull exp.&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;th. unc.&#39;</span><span class="p">,</span> <span class="s1">&#39;theory&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">sort_by</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sort_keys</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; is not an allowed value for sort_by. Allowed values are &quot;</span>
            <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39;, and &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sort_by</span><span class="p">,</span> <span class="s2">&quot;&#39;, &#39;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sort_keys</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                                     <span class="n">sort_keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">)</span>
    <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_tree</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">sort_by</span> <span class="o">==</span> <span class="s1">&#39;pull exp.&#39;</span><span class="p">:</span>
        <span class="c1"># if sorted by pull exp., use descending order as default</span>
        <span class="k">if</span> <span class="n">ascending</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">min_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">min_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_pull_exp</span><span class="p">,</span> <span class="n">min_val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">min_val</span> <span class="o">=</span> <span class="n">min_pull_exp</span>
    <span class="k">elif</span> <span class="n">min_pull_exp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;pull exp.&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_pull_exp</span>
    <span class="c1"># if sorted not by pull exp., use ascending order as default</span>
    <span class="k">if</span> <span class="n">ascending</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ascending</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obstable_filter_sort</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">sortkey</span><span class="o">=</span><span class="n">sort_by</span><span class="p">,</span>
                                      <span class="n">ascending</span><span class="o">=</span><span class="n">ascending</span><span class="p">,</span>
                                      <span class="n">min_val</span><span class="o">=</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="n">max_val</span><span class="p">,</span>
                                      <span class="n">subset</span><span class="o">=</span><span class="n">subset</span><span class="p">)</span>
    <span class="c1"># create DataFrame</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">info</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="c1"># if df has length 0 (e.g. if min_pull is very large) there are no</span>
    <span class="c1"># columns that could be removed</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="c1"># remove columns that are only used internal and should not be</span>
        <span class="c1"># included in obstable</span>
        <span class="k">del</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;inspire&#39;</span><span class="p">])</span>
        <span class="k">del</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;lh_name&#39;</span><span class="p">])</span>
        <span class="k">del</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="k">del</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;exp. PDF&#39;</span><span class="p">])</span>
        <span class="k">del</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ll_central&#39;</span><span class="p">])</span>
        <span class="k">del</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ll_sm&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smelli.classes.GlobalLikelihoodPoint.pvalue_dict">
    <p>def <span class="ident">pvalue_dict</span>(</p><p>self, n_par=0)</p>
    </div>
    

    
  
    <div class="desc"><p>Dictionary of $p$ values of sublikelihoods given the number <code>n_par</code>
of free parameters (default 0).</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smelli.classes.GlobalLikelihoodPoint.pvalue_dict', this);">Show source &equiv;</a></p>
  <div id="source-smelli.classes.GlobalLikelihoodPoint.pvalue_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">pvalue_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_par</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Dictionary of $p$ values of sublikelihoods given the number `n_par`</span>
<span class="sd">    of free parameters (default 0).&quot;&quot;&quot;</span>
    <span class="n">nobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">number_observations_dict</span><span class="p">()</span>
    <span class="n">chi2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chi2_dict</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">pvalue</span><span class="p">(</span><span class="n">chi2</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">dof</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nobs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">n_par</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">chi2</span><span class="p">}</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="smelli.classes.GlobalLikelihoodPoint.fix_ckm" class="name">var <span class="ident">fix_ckm</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smelli.classes.GlobalLikelihoodPoint.likelihood" class="name">var <span class="ident">likelihood</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smelli.classes.GlobalLikelihoodPoint.par_dict_np" class="name">var <span class="ident">par_dict_np</span></p>
            

            
  
    <div class="desc"><p>Return the dictionary of parameters where the four CKM parameters
<code>Vus</code>, <code>Vcb</code>, <code>Vub</code>, <code>delta</code> have been replaced by their
"true" values as extracted from the four input observables.</p>
<p>Note that if <code>fix_ckm</code> is set to <code>True</code>, this method actually
returns the SM values.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smelli.classes.GlobalLikelihoodPoint.w" class="name">var <span class="ident">w</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smelli.classes.GlobalLikelihoodPoint.w_input" class="name">var <span class="ident">w_input</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>

    <script>
      renderMathInElement(document.body, options={delimiters:[
  {left: "$$", right: "$$", display: true},
  {left: "\\[", right: "\\]", display: true},
  {left: "\\(", right: "\\)", display: false},
  {left: "$", right: "$", display: false}
]});
    </script>
    <script type="text/javascript">
    $("script[type='math/tex; mode=display']").replaceWith(
      function(){
        var tex = $(this).text();
        return "<span class=\"katex-display\">" +
               katex.renderToString("\\displaystyle "+tex) +
               "</span>";
    });
    </script>

</body>
</html>
